# é¡¹ç›®ç»“æ„è¯´æ˜

## ğŸ“‚ å®Œæ•´ç›®å½•æ ‘

```
ainovel_v3/
â”‚
â”œâ”€â”€ ğŸ¯ æ ¸å¿ƒæ¡†æ¶ï¼ˆé€šç”¨å¯å¤ç”¨ï¼‰
â”‚   â”œâ”€â”€ orchestrator.py              # å¤šæ™ºèƒ½ä½“ç¼–æ’å™¨ä¸»ç¨‹åº
â”‚   â”œâ”€â”€ test_project_module.py       # é…ç½®æ¨¡å—æµ‹è¯•è„šæœ¬
â”‚   â”œâ”€â”€ README.md                    # é¡¹ç›®ä¸»æ–‡æ¡£
â”‚   â”œâ”€â”€ REFACTORING_SUMMARY.md       # é‡æ„è¯´æ˜æ–‡æ¡£
â”‚   â””â”€â”€ AGENTS.md                    # (å…¶ä»–æ–‡æ¡£)
â”‚
â”œâ”€â”€ ğŸ“¦ é¡¹ç›®å®ç°ï¼ˆAIå°è¯´ç³»ç»Ÿï¼‰
â”‚   â””â”€â”€ project/
â”‚       â”œâ”€â”€ __init__.py              # é…ç½®æ¨¡å—å¯¼å‡º
â”‚       â”œâ”€â”€ config.py                # ProjectConfig ç±»
â”‚       â”œâ”€â”€ templates.py             # ProjectTemplates ç±»
â”‚       â”œâ”€â”€ README.md                # é¡¹ç›®æ¨¡å—æ–‡æ¡£
â”‚       â”‚
â”‚       â”œâ”€â”€ backend/                 # AI å°è¯´åç«¯æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ app/
â”‚       â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”‚   â”œâ”€â”€ main.py          # FastAPI ä¸»åº”ç”¨
â”‚       â”‚   â”‚   â”œâ”€â”€ models.py        # æ•°æ®æ¨¡å‹
â”‚       â”‚   â”‚   â”œâ”€â”€ config.py        # åç«¯é…ç½®
â”‚       â”‚   â”‚   â”œâ”€â”€ llm/             # LLM ç›¸å…³
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ prompts.py
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ schemas.py
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ topone_gateway.py
â”‚       â”‚   â”‚   â”œâ”€â”€ storage/         # å›¾æ•°æ®åº“
â”‚       â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ graph.py
â”‚       â”‚   â”‚   â”œâ”€â”€ logic/           # ä¸šåŠ¡é€»è¾‘
â”‚       â”‚   â”‚   â”‚   â””â”€â”€ snowflake_manager.py
â”‚       â”‚   â”‚   â””â”€â”€ services/        # æœåŠ¡å±‚
â”‚       â”‚   â”‚       â”œâ”€â”€ llm_engine.py
â”‚       â”‚   â”‚       â””â”€â”€ topone_client.py
â”‚       â”‚   â”œâ”€â”€ data/                # Kuzu æ•°æ®åº“æ–‡ä»¶
â”‚       â”‚   â”‚   â””â”€â”€ snowflake.db
â”‚       â”‚   â”œâ”€â”€ tests/               # å•å…ƒæµ‹è¯•
â”‚       â”‚   â”‚   â”œâ”€â”€ test_api.py
â”‚       â”‚   â”‚   â”œâ”€â”€ test_models.py
â”‚       â”‚   â”‚   â”œâ”€â”€ test_storage.py
â”‚       â”‚   â”‚   â””â”€â”€ ...
â”‚       â”‚   â”œâ”€â”€ .env.example         # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”‚       â”‚   â”œâ”€â”€ pyproject.toml       # é¡¹ç›®é…ç½®
â”‚       â”‚   â””â”€â”€ README.md            # åç«¯æ–‡æ¡£
â”‚       â”‚
â”‚       â”œâ”€â”€ scripts/                 # æµ‹è¯•å’Œæ£€æŸ¥è„šæœ¬
â”‚       â”‚   â”œâ”€â”€ cyberpunk_integration_test.py
â”‚       â”‚   â”œâ”€â”€ graph_health_check.py
â”‚       â”‚   â”œâ”€â”€ m5_ontology_check.py
â”‚       â”‚   â””â”€â”€ m6_negotiation_check.py
â”‚       â”‚
â”‚       â””â”€â”€ data_backup/             # æ—§æ•°æ®å¤‡ä»½
â”‚           â””â”€â”€ snowflake.db
â”‚
â”œâ”€â”€ ğŸ§  Orchestrator é»‘æ¿ï¼ˆè¿è¡Œæ—¶çŠ¶æ€ï¼‰
â”‚   â””â”€â”€ memory/
â”‚       â”œâ”€â”€ global_context.md        # å…¨å±€ä¸Šä¸‹æ–‡å’Œçº¦æŸ
â”‚       â”œâ”€â”€ project_history.md       # é¡¹ç›®å†å²ï¼ˆè¿½åŠ å†™å…¥ï¼‰
â”‚       â”œâ”€â”€ dev_plan.md              # å¼€å‘è®¡åˆ’å¿«ç…§
â”‚       â”œâ”€â”€ subagent_prompt_main.md  # MAIN ä»£ç†æç¤ºè¯
â”‚       â”œâ”€â”€ subagent_prompt_test.md  # TEST ä»£ç†æç¤ºè¯
â”‚       â”œâ”€â”€ subagent_prompt_dev.md   # DEV ä»£ç†æç¤ºè¯
â”‚       â””â”€â”€ subagent_prompt_review.md# REVIEW ä»£ç†æç¤ºè¯
â”‚
â”œâ”€â”€ ğŸ“‹ Orchestrator å·¥ä½œåŒºï¼ˆå·¥å•ï¼‰
â”‚   â””â”€â”€ workspace/
â”‚       â”œâ”€â”€ main/
â”‚       â”‚   â””â”€â”€ dev_plan_next.md     # dev_plan è‰æ¡ˆ
â”‚       â”œâ”€â”€ test/
â”‚       â”‚   â””â”€â”€ current_task.md      # TEST å·¥å•
â”‚       â”œâ”€â”€ dev/
â”‚       â”‚   â””â”€â”€ current_task.md      # DEV å·¥å•
â”‚       â””â”€â”€ review/
â”‚           â””â”€â”€ current_task.md      # REVIEW å·¥å•
â”‚
â”œâ”€â”€ ğŸ“Š Orchestrator æŠ¥å‘Šè¾“å‡º
â”‚   â””â”€â”€ reports/
â”‚       â”œâ”€â”€ report_test.md           # TEST ä»£ç†æŠ¥å‘Š
â”‚       â”œâ”€â”€ report_dev.md            # DEV ä»£ç†æŠ¥å‘Š
â”‚       â”œâ”€â”€ report_review.md         # REVIEW ä»£ç†æŠ¥å‘Š
â”‚       â”œâ”€â”€ report_main_decision.json# MAIN å†³ç­– JSON
â”‚       â”œâ”€â”€ orchestrator.log         # ç¼–æ’å™¨æ—¥å¿—
â”‚       â””â”€â”€ backups/                 # å†å²å¤‡ä»½
â”‚
â””â”€â”€ ğŸ”§ Orchestrator å†…éƒ¨çŠ¶æ€
    â””â”€â”€ .codex/
        â”œâ”€â”€ main_session_id.txt      # MAIN ä¼šè¯ ID
        â””â”€â”€ main_iteration.txt       # å½“å‰è¿­ä»£æ¬¡æ•°
```

## ğŸ¯ æ–‡ä»¶èŒè´£è¯´æ˜

### æ ¸å¿ƒæ¡†æ¶æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ | å¯å¤ç”¨æ€§ |
|------|------|----------|
| `orchestrator.py` | å¤šæ™ºèƒ½ä½“ç¼–æ’å™¨ä¸»ç¨‹åº | âœ… å®Œå…¨é€šç”¨ |
| `test_project_module.py` | é…ç½®æ¨¡å—æµ‹è¯• | âœ… å¯ä½œä¸ºæ¨¡æ¿ |
| `README.md` | é¡¹ç›®æ€»æ–‡æ¡£ | âš ï¸ éœ€ä¿®æ”¹ |
| `REFACTORING_SUMMARY.md` | é‡æ„è¯´æ˜ | âš ï¸ éœ€ä¿®æ”¹ |

### é¡¹ç›®é…ç½®æ–‡ä»¶

| æ–‡ä»¶ | èŒè´£ | å¯å¤ç”¨æ€§ |
|------|------|----------|
| `project/config.py` | Orchestrator è·¯å¾„å’Œè§„åˆ™é…ç½® | âŒ é¡¹ç›®ç‰¹å®š |
| `project/templates.py` | Orchestrator åˆå§‹åŒ–æ¨¡æ¿ | âŒ é¡¹ç›®ç‰¹å®š |
| `project/README.md` | é¡¹ç›®æ¨¡å—æ–‡æ¡£ | âŒ é¡¹ç›®ç‰¹å®š |

### åº”ç”¨å®ç°æ–‡ä»¶

| ç›®å½• | èŒè´£ | æŠ€æœ¯æ ˆ |
|------|------|--------|
| `project/backend/` | AI å°è¯´åç«¯æœåŠ¡ | FastAPI + Kuzu + Gemini |
| `project/scripts/` | æµ‹è¯•å’Œæ£€æŸ¥è„šæœ¬ | Python |
| `project/data_backup/` | æ—§æ•°æ®å¤‡ä»½ | SQLite |

### Orchestrator è¿è¡Œæ—¶æ–‡ä»¶

| ç›®å½• | èŒè´£ | ç”±è°ç®¡ç† |
|------|------|----------|
| `memory/` | é»‘æ¿ï¼ˆå…±äº«çŠ¶æ€ï¼‰ | MAIN å†™å…¥ï¼Œæ‰€æœ‰ä»£ç†è¯»å– |
| `workspace/` | å·¥å•ï¼ˆä»»åŠ¡åˆ†é…ï¼‰ | MAIN å†™å…¥ï¼Œå­ä»£ç†è¯»å– |
| `reports/` | æŠ¥å‘Šï¼ˆæ‰§è¡Œç»“æœï¼‰ | ç¼–æ’å™¨ä¿å­˜ï¼ŒMAIN è¯»å– |
| `.codex/` | ä¼šè¯çŠ¶æ€ | ç¼–æ’å™¨ç®¡ç† |

## ğŸ”„ æ•°æ®æµå‘

### 1. é»‘æ¿æ¨¡å¼ï¼ˆBlackboard Patternï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            memory/ï¼ˆé»‘æ¿ï¼‰                â”‚
â”‚  - project_history.md  ï¼ˆåªè¿½åŠ ï¼‰        â”‚
â”‚  - dev_plan.md         ï¼ˆå¯è¦†ç›–ï¼‰        â”‚
â”‚  - global_context.md   ï¼ˆäººå·¥ç»´æŠ¤ï¼‰      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†‘ è¯»å–                â†“ å†™å…¥
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ å­ä»£ç†  â”‚              â”‚  MAIN  â”‚
    â”‚        â”‚              â”‚        â”‚
    â”‚TEST    â”‚              â”‚ è¯»å†å²  â”‚
    â”‚DEV     â”‚              â”‚ è¯»è®¡åˆ’  â”‚
    â”‚REVIEW  â”‚              â”‚ å†™æ—¥å¿—  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚ å†™å·¥å•  â”‚
         â†‘                  â”‚ è¾“å‡ºJSONâ”‚
         â”‚ è¯»å·¥å•            â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                       â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
    â”‚ workspace/ â”‚ â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚ (å·¥å•æ–‡ä»¶) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ æ‰§è¡Œå
         â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  reports/  â”‚
    â”‚ (æŠ¥å‘Šæ–‡ä»¶) â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. ç¼–æ’æµç¨‹

```
ç”¨æˆ·å¯åŠ¨
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ orchestrator â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ è§¦å‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ MAIN ä»£ç†    â”‚ â† æ³¨å…¥ memory/
â”‚              â”‚
â”‚ 1. è¯»é»‘æ¿    â”‚
â”‚ 2. å†™æ—¥å¿—    â”‚
â”‚ 3. å†™å·¥å•    â”‚
â”‚ 4. è¾“å‡ºJSON  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ è§£æ JSON
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ next_agent?  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TEST / DEV / REVIEW      â”‚ â† è¯» workspace/å·¥å•
â”‚                          â”‚
â”‚ è¯»å·¥å• â†’ æ‰§è¡Œ â†’ è¾“å‡ºæŠ¥å‘Š â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ ä¿å­˜åˆ°
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  reports/    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   â†“ ä¸‹ä¸€è½®
MAIN å†æ¬¡è¿è¡Œ...
```

## ğŸ“ é…ç½®æ–‡ä»¶å…³ç³»

### orchestrator.py ä½¿ç”¨çš„é…ç½®

```python
from project import ProjectConfig, ProjectTemplates

CONFIG = ProjectConfig(PROJECT_ROOT)

# è·¯å¾„é…ç½®
MEMORY_DIR = CONFIG.memory_dir
DEV_PLAN_FILE = CONFIG.dev_plan_file

# éªŒè¯è§„åˆ™
DEV_PLAN_ALLOWED_STATUSES = CONFIG.dev_plan_allowed_statuses

# åˆå§‹åŒ–æ¨¡æ¿
_write_text_if_missing(
    CONFIG.global_context_file,
    ProjectTemplates.global_context()
)
```

### backend/ ä½¿ç”¨çš„é…ç½®

```python
# project/backend/app/config.py
from pydantic_settings import BaseSettings

class Settings(BaseSettings):
    gemini_api_key: str
    kuzu_db_path: str = "project/backend/data/snowflake.db"
    # ...
```

**ä¸¤è€…å®Œå…¨ç‹¬ç«‹ï¼Œä¸äº’ç›¸ä¾èµ–ï¼**

## ğŸš€ å¿«é€Ÿå¯¼èˆª

- ä¿®æ”¹ orchestrator é…ç½® â†’ `project/config.py`
- ä¿®æ”¹ orchestrator æ¨¡æ¿ â†’ `project/templates.py`
- ä¿®æ”¹åç«¯é…ç½® â†’ `project/backend/app/config.py`
- æŸ¥çœ‹å¼€å‘è®¡åˆ’ â†’ `memory/dev_plan.md`
- æŸ¥çœ‹é¡¹ç›®å†å² â†’ `memory/project_history.md`
- æŸ¥çœ‹æœ€æ–°æŠ¥å‘Š â†’ `reports/report_*.md`
- è¿è¡Œåç«¯ â†’ `cd project/backend && uvicorn app.main:app`
- è¿è¡Œ orchestrator â†’ `python orchestrator.py --ui`

## ğŸ’¡ è®¾è®¡ç†å¿µ

### åˆ†ç¦»åŸåˆ™

1. **æ¡†æ¶ vs åº”ç”¨**
   - `orchestrator.py` = æ¡†æ¶
   - `project/backend/` = åº”ç”¨

2. **é…ç½® vs ä»£ç **
   - `project/config.py` = é…ç½®
   - `orchestrator.py` = ä»£ç ï¼ˆä¸æ”¹ï¼‰

3. **é€šç”¨ vs ç‰¹å®š**
   - é€šç”¨ï¼šå¯å¤ç”¨åˆ°å…¶ä»–é¡¹ç›®
   - ç‰¹å®šï¼šAI å°è¯´é¡¹ç›®ä¸“ç”¨

### å¯å¤ç”¨æ€§

è¦å°†æ­¤æ¡†æ¶ç”¨äºæ–°é¡¹ç›®ï¼š

```bash
# 1. å¤åˆ¶æ¡†æ¶
cp orchestrator.py new_project/
cp -r memory/ new_project/

# 2. æ›¿æ¢é…ç½®
cp -r project/ new_project/project/
# ä¿®æ”¹ new_project/project/config.py
# ä¿®æ”¹ new_project/project/templates.py

# 3. è¿è¡Œ
cd new_project
python orchestrator.py --ui
```

å®Œæˆï¼
