ğŸ”´ Orchestrator TDD å·¥ä½œæµä¿®å¤ - ä¸¥å‰ä»£ç è¯„ä¼°æŠ¥å‘Š

ğŸ“Š æ€»ä½“è¯„åˆ†ï¼š6.5/10ï¼ˆåŠæ ¼ä½†é—®é¢˜ä¸¥é‡ï¼‰

---
âœ… å·²å®Œæˆçš„å·¥ä½œï¼ˆæ­£é¢è¯„ä»·ï¼‰

1. MAIN ä»£ç†å†³ç­–è§„åˆ™ä¿®å¤ â­â­â­â­ (4/5)

å·²å®Œæˆï¼š
- âœ… åœ¨ subagent_prompt_main.md ä¸­æ·»åŠ äº† TDD å¼ºåˆ¶è§„åˆ™ï¼ˆç¬¬72-76è¡Œï¼‰
- âœ… è§„åˆ™3ï¼šä»£ç å˜æ›´åå¿…é¡»æµ‹è¯•ï¼ˆæ£€æµ‹ report_stage_changes.jsonï¼‰
- âœ… è§„åˆ™4ï¼šæ–°åŠŸèƒ½å¿…é¡»å…ˆå†™æµ‹è¯•ï¼ˆæ£€æµ‹ test_required: trueï¼‰
- âœ… è§„åˆ™ä¼˜å…ˆçº§æ˜ç¡®ï¼šTDD è§„åˆ™æ’åœ¨ç¬¬3ã€4ä½ï¼ˆä»…æ¬¡äº USER å’Œ FINISHï¼‰

ä¼˜ç‚¹ï¼š
- å†³ç­–è§„åˆ™æ¸…æ™°ä¸”å¯æ‰§è¡Œ
- ä½¿ç”¨ report_stage_changes.json ä½œä¸ºå®¢è§‚ä¾æ®
- æ”¯æŒ test_required æ ‡è®°å­—æ®µ

é—®é¢˜ï¼š
- âš ï¸ è§„åˆ™æè¿°åœ¨æç¤ºè¯ä¸­ï¼Œä½† MAIN ä»£ç†æ˜¯å¦çœŸçš„ä¼šéµå®ˆï¼Ÿéœ€è¦å®é™…æµ‹è¯•éªŒè¯
- âš ï¸ ç¼ºå°‘å¯¹ MAIN å†³ç­–çš„éªŒè¯æœºåˆ¶ï¼ˆå¦‚æœ MAIN ä¸éµå®ˆè§„åˆ™æ€ä¹ˆåŠï¼Ÿï¼‰

---
2. ä»£ç å˜æ›´è·Ÿè¸ªæœºåˆ¶ â­â­â­â­â­ (5/5)

å·²å®Œæˆï¼š
- âœ… æ–°å¢ orchestrator/repo_changes.py æ¨¡å—ï¼ˆ107è¡Œï¼‰
- âœ… å®ç° capture_dirty_file_digests() - æ•è· git dirty æ–‡ä»¶çš„ SHA256
- âœ… å®ç° diff_dirty_file_digests() - å¯¹æ¯”å‰åå¿«ç…§
- âœ… åœ¨ workflow.py ä¸­é›†æˆ _run_subagent_stage_tracked() å‡½æ•°
- âœ… ç”Ÿæˆ report_stage_changes.json åŒ…å« code_changed å’Œ code_changed_files

ä¼˜ç‚¹ï¼š
- å®ç°è´¨é‡é«˜ï¼Œä»£ç æ¸…æ™°
- ä½¿ç”¨ SHA256 ç¡®ä¿å‡†ç¡®æ€§
- æ”¯æŒ rename/copy ç­‰å¤æ‚ git æ“ä½œ
- æ€§èƒ½ä¼˜åŒ–ï¼š1MB å—è¯»å–æ–‡ä»¶

é—®é¢˜ï¼š
- âš ï¸ _is_code_change_path() å‡½æ•°çš„å®ç°æœªè¯»å–åˆ°ï¼Œä¸ç¡®å®šå¦‚ä½•åˆ¤æ–­"ä»£ç æ–‡ä»¶"
- âš ï¸ ç¼ºå°‘å¯¹ orchestrator/ å’Œ .codex/ ç­‰ç›®å½•çš„æ’é™¤é€»è¾‘

---
3. Workflow é›†æˆ â­â­â­â­ (4/5)

å·²å®Œæˆï¼š
- âœ… _run_subagent_stage_tracked() åœ¨å­ä»£ç†æ‰§è¡Œå‰åæ•è·æ–‡ä»¶å˜æ›´
- âœ… _write_stage_changes() å†™å…¥å˜æ›´æ‘˜è¦åˆ° JSON
- âœ… _load_stage_changes() åŠ è½½å˜æ›´æ‘˜è¦
- âœ… åœ¨ MAIN æç¤ºè¯æ„å»ºæ—¶æ³¨å…¥ TDD å¼ºåˆ¶æŒ‡ä»¤ï¼ˆç¬¬1475-1484è¡Œï¼‰

ä¼˜ç‚¹ï¼š
- é›†æˆç‚¹é€‰æ‹©åˆç†
- æ—¥å¿—è®°å½•å®Œæ•´
- é”™è¯¯å¤„ç†ä¸¥æ ¼

é—®é¢˜ï¼š
- âš ï¸ ç¬¬1480-1481è¡Œçš„"å¼ºåˆ¶æŒ‡ä»¤"åªæ˜¯æ–‡æœ¬æç¤ºï¼Œä¸æ˜¯ç¡¬ç¼–ç é€»è¾‘
- âš ï¸ å¦‚æœ MAIN ä»£ç†å¿½ç•¥æŒ‡ä»¤ï¼Œæ²¡æœ‰åå¤‡æœºåˆ¶

---
âŒ ä¸¥é‡é—®é¢˜å’Œç¼ºå¤±ï¼ˆè´Ÿé¢è¯„ä»·ï¼‰

1. ğŸ”´ è‡´å‘½é—®é¢˜ï¼šç¼ºå°‘ç¡¬ç¼–ç å¼ºåˆ¶æœºåˆ¶ â­ (1/5)

é—®é¢˜æè¿°ï¼š
å½“å‰å®ç°å®Œå…¨ä¾èµ– MAIN ä»£ç†çš„"è‡ªè§‰æ€§"ï¼Œæ²¡æœ‰ç¡¬ç¼–ç çš„å¼ºåˆ¶é€»è¾‘ã€‚

è¯æ®ï¼š
# workflow.py:1475-1482
if stage_agent == "DEV" and code_changed:
   must_test_after_dev = True  # âŒ è¿™ä¸ªå˜é‡è®¾ç½®äº†ä½†æ²¡æœ‰è¢«ä½¿ç”¨ï¼
   extra_instructions.append(
         "ã€TDD å¼ºåˆ¶è§„åˆ™ã€‘æ£€æµ‹åˆ°ä¸Šä¸€è½® DEV äº§ç”Ÿä»£ç å˜æ›´ï¼Œå› æ­¤æœ¬è½®å¿…é¡»å…ˆæ´¾å‘ TEST..."
   )

é—®é¢˜ï¼š
1. must_test_after_dev = True è®¾ç½®åæ²¡æœ‰ä»»ä½•åœ°æ–¹æ£€æŸ¥è¿™ä¸ªå˜é‡
2. åªæ˜¯åœ¨æç¤ºè¯ä¸­æ·»åŠ äº†"å¼ºåˆ¶è§„åˆ™"æ–‡æœ¬
3. å¦‚æœ MAIN ä»£ç†è¾“å‡º next_agent=REVIEW è€Œä¸æ˜¯ TESTï¼Œç³»ç»Ÿä¼šç…§å¸¸æ‰§è¡Œ
4. æ²¡æœ‰éªŒè¯é€»è¾‘æ£€æŸ¥ MAIN çš„å†³ç­–æ˜¯å¦ç¬¦åˆ TDD è§„åˆ™

åº”è¯¥æ€ä¹ˆåšï¼š
# åœ¨ MAIN å†³ç­–è§£æåï¼Œæ·»åŠ éªŒè¯é€»è¾‘
if must_test_after_dev and decision["next_agent"] != "TEST":
   if decision["next_agent"] != "USER":  # å…è®¸ USER å†³ç­–è¦†ç›–
         raise RuntimeError(
            f"TDD è§„åˆ™è¿åï¼šDEV äº§ç”Ÿä»£ç å˜æ›´åå¿…é¡»æ´¾å‘ TESTï¼Œ"
            f"ä½† MAIN å†³ç­–ä¸º {decision['next_agent']}"
         )

ä¸¥é‡æ€§ï¼šâ­â­â­â­â­ (5/5 - è‡´å‘½)

è¿™æ˜¯æœ€ä¸¥é‡çš„é—®é¢˜ï¼Œå¯¼è‡´æ•´ä¸ª TDD ä¿®å¤å½¢åŒè™šè®¾ã€‚

---
2. ğŸ”´ ç¼ºå°‘ test_required å­—æ®µçš„æ£€æµ‹é€»è¾‘ â­â­ (2/5)

é—®é¢˜æè¿°ï¼š
æç¤ºè¯ä¸­æåˆ°"è‹¥ dev_plan å­˜åœ¨ test_required: true çš„ä»»åŠ¡"ï¼Œä½†æ²¡æœ‰ä»£ç å®ç°æ£€æµ‹é€»è¾‘ã€‚

è¯æ®ï¼š
- subagent_prompt_main.md ç¬¬76è¡Œæåˆ° test_required: true
- ä½† workflow.py ä¸­æ²¡æœ‰è§£æ dev_plan å¹¶æ£€æŸ¥ test_required å­—æ®µçš„ä»£ç 
- MAIN ä»£ç†éœ€è¦è‡ªå·±è§£æ dev_plan å¹¶åˆ¤æ–­ï¼Œå®¹æ˜“å‡ºé”™

åº”è¯¥æ€ä¹ˆåšï¼š
# åœ¨ workflow.py ä¸­æ·»åŠ 
def _check_test_required_tasks(dev_plan_text: str) -> bool:
   """æ£€æŸ¥ dev_plan ä¸­æ˜¯å¦æœ‰ test_required: true çš„ TODO/DOING ä»»åŠ¡"""
   # è§£æ dev_planï¼ŒæŸ¥æ‰¾ test_required: true ä¸”çŠ¶æ€ä¸º TODO/DOING/BLOCKED çš„ä»»åŠ¡
   # è¿”å› True å¦‚æœéœ€è¦å…ˆå†™æµ‹è¯•
   pass

# åœ¨ MAIN æç¤ºè¯æ„å»ºæ—¶
if _check_test_required_tasks(dev_plan_text):
   extra_instructions.append("æ£€æµ‹åˆ° test_required ä»»åŠ¡ï¼Œå¿…é¡»å…ˆæ´¾å‘ TEST")

ä¸¥é‡æ€§ï¼šâ­â­â­â­ (4/5 - é«˜)

---
3. ğŸŸ¡ DEV å’Œ TEST ä»£ç†æç¤ºè¯ä¿®æ”¹ä¸å®Œæ•´ â­â­â­ (3/5)

é—®é¢˜æè¿°ï¼š
è™½ç„¶ä¿®æ”¹äº†æç¤ºè¯ï¼Œä½†ç¼ºå°‘å…³é”®çº¦æŸã€‚

DEV ä»£ç†é—®é¢˜ï¼š
- âœ… å·²æ·»åŠ  TDD è¦æ±‚ï¼ˆç¬¬58è¡Œï¼‰
- âŒ ä½†æ²¡æœ‰ç¦æ­¢ DEV è·³è¿‡æµ‹è¯•çš„å¼ºåˆ¶çº¦æŸ
- âŒ æ²¡æœ‰è¦æ±‚ DEV æŠ¥å‘Šä¸­å¿…é¡»åŒ…å«"æµ‹è¯•è¿è¡Œç»“æœ"

TEST ä»£ç†é—®é¢˜ï¼š
- â“ æœªè¯»å–åˆ° subagent_prompt_test.md çš„å®Œæ•´å†…å®¹
- â“ ä¸ç¡®å®šæ˜¯å¦æ˜ç¡®äº† TEST çš„èŒè´£è¾¹ç•Œ

åº”è¯¥æ€ä¹ˆåšï¼š
# subagent_prompt_dev.md ä¸­åº”æ·»åŠ 

## ç¦æ­¢äº‹é¡¹ï¼ˆå¼ºåˆ¶ï¼‰
- âŒ ç¦æ­¢è·³è¿‡æµ‹è¯•ï¼šå³ä½¿ä½ è®¤ä¸º"ä»£ç å¾ˆç®€å•ä¸éœ€è¦æµ‹è¯•"ï¼Œä¹Ÿå¿…é¡»è¿è¡Œæµ‹è¯•
- âŒ ç¦æ­¢ä¿®æ”¹æµ‹è¯•ä»£ç ï¼šé™¤é MAIN æ˜ç¡®è¦æ±‚ä¿®å¤æµ‹è¯•
- âŒ ç¦æ­¢åœ¨æŠ¥å‘Šä¸­å£°ç§°"å·²æµ‹è¯•"è€Œæ²¡æœ‰è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•

## æŠ¥å‘Šè¦æ±‚
- å¿…é¡»åŒ…å«"æµ‹è¯•è¿è¡Œç»“æœ"ç« èŠ‚
- å¿…é¡»æŠ¥å‘Šæµ‹è¯•é€šè¿‡ç‡å’Œè¦†ç›–ç‡
- è‹¥æµ‹è¯•å¤±è´¥ï¼Œå¿…é¡»æ ‡è®°ä¸ºé˜»å¡

ä¸¥é‡æ€§ï¼šâ­â­â­ (3/5 - ä¸­)

---
4. ğŸŸ¡ ç¼ºå°‘æµ‹è¯•è¦†ç›–ç‡é—¨ç¦ â­ (1/5)

é—®é¢˜æè¿°ï¼š
ä¼˜åŒ–æ–¹æ¡ˆä¸­æåˆ°çš„"æµ‹è¯•è¦†ç›–ç‡é—¨ç¦"å®Œå…¨æ²¡æœ‰å®ç°ã€‚

ç¼ºå¤±å†…å®¹ï¼š
- âŒ æ²¡æœ‰ä¿®æ”¹ verification_policy.json
- âŒ æ²¡æœ‰åœ¨ validation.py ä¸­å®ç°è¦†ç›–ç‡æ£€æŸ¥
- âŒ æ²¡æœ‰é›†æˆ coverage.py å·¥å…·
- âŒ REVIEW ä»£ç†æ— æ³•éªŒè¯è¦†ç›–ç‡

ä¸¥é‡æ€§ï¼šâ­â­â­ (3/5 - ä¸­)

è¿™æ˜¯ä¼˜åŒ–æ–¹æ¡ˆçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œä½†å®Œå…¨ç¼ºå¤±ã€‚

---
5. ğŸŸ¡ ç¼ºå°‘ dev_plan ç»“æ„æ‰©å±• â­ (1/5)

é—®é¢˜æè¿°ï¼š
ä¼˜åŒ–æ–¹æ¡ˆä¸­æåˆ°çš„"æµ‹è¯•ä¸å®ç°åˆ†ç¦»"çš„ dev_plan ç»“æ„æ²¡æœ‰å®ç°ã€‚

ç¼ºå¤±å†…å®¹ï¼š
- âŒ æ²¡æœ‰æ–°çš„ä»»åŠ¡ç»“æ„ï¼ˆæµ‹è¯•é˜¶æ®µã€å®ç°é˜¶æ®µã€å®¡é˜…é˜¶æ®µï¼‰
- âŒ æ²¡æœ‰è¿ç§»è„šæœ¬
- âŒ æ²¡æœ‰ä¿®æ”¹ validation.py çš„éªŒè¯é€»è¾‘

å½“å‰çŠ¶æ€ï¼š
- ä»ç„¶ä½¿ç”¨æ—§çš„å•ä¸€ä»»åŠ¡ç»“æ„
- åªæ˜¯æ·»åŠ äº†å¯é€‰çš„ test_required å’Œ task_type å­—æ®µ

ä¸¥é‡æ€§ï¼šâ­â­ (2/5 - ä½)

è¿™æ˜¯é•¿æœŸä¼˜åŒ–ï¼Œå¯ä»¥åç»­å®ç°ã€‚

---
6. ğŸŸ¡ ç¼ºå°‘å•å…ƒæµ‹è¯• â­ (1/5)

é—®é¢˜æè¿°ï¼š
æ–°å¢çš„ä»£ç æ²¡æœ‰å¯¹åº”çš„å•å…ƒæµ‹è¯•ã€‚

ç¼ºå¤±æµ‹è¯•ï¼š
- âŒ repo_changes.py çš„æµ‹è¯•
- âŒ _run_subagent_stage_tracked() çš„æµ‹è¯•
- âŒ _write_stage_changes() çš„æµ‹è¯•
- âŒ TDD è§„åˆ™è§¦å‘çš„é›†æˆæµ‹è¯•

ä¸¥é‡æ€§ï¼šâ­â­â­â­ (4/5 - é«˜)

ä¿®å¤ TDD æµç¨‹çš„ä»£ç æœ¬èº«æ²¡æœ‰æµ‹è¯•ï¼Œè¿™æ˜¯è®½åˆºã€‚

---
ğŸ“‹ ä¸‹ä¸€æ­¥åº”è¯¥å®Œæˆçš„å†…å®¹ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼‰

P0 - è‡´å‘½é—®é¢˜ï¼ˆå¿…é¡»ç«‹å³ä¿®å¤ï¼‰

1. æ·»åŠ  TDD è§„åˆ™çš„ç¡¬ç¼–ç éªŒè¯ â­â­â­â­â­

ä½ç½®ï¼šorchestrator/workflow.py

éœ€è¦æ·»åŠ ï¼š
# åœ¨ _parse_main_output() ä¹‹åï¼Œæ·»åŠ éªŒè¯é€»è¾‘
def _validate_tdd_rules(
   *,
   decision: dict,
   must_test_after_dev: bool,
   test_required_tasks: bool,
) -> None:
   """éªŒè¯ MAIN å†³ç­–æ˜¯å¦ç¬¦åˆ TDD è§„åˆ™"""
   next_agent = decision["next_agent"]

   # è§„åˆ™1ï¼šDEV ä»£ç å˜æ›´åå¿…é¡» TEST
   if must_test_after_dev and next_agent not in {"TEST", "USER", "FINISH"}:
         raise RuntimeError(
            f"TDD è§„åˆ™è¿åï¼šDEV äº§ç”Ÿä»£ç å˜æ›´åå¿…é¡»æ´¾å‘ TESTï¼Œ"
            f"ä½† MAIN å†³ç­–ä¸º {next_agent}ã€‚"
            f"å¦‚éœ€è¦†ç›–æ­¤è§„åˆ™ï¼Œè¯·ä½¿ç”¨ USER å†³ç­–ã€‚"
         )

   # è§„åˆ™2ï¼štest_required ä»»åŠ¡å¿…é¡»å…ˆ TEST
   if test_required_tasks and next_agent == "DEV":
         raise RuntimeError(
            f"TDD è§„åˆ™è¿åï¼šå­˜åœ¨ test_required=true çš„ä»»åŠ¡ï¼Œ"
            f"å¿…é¡»å…ˆæ´¾å‘ TEST å†™æµ‹è¯•ï¼Œä½† MAIN å†³ç­–ä¸º DEVã€‚"
         )

# åœ¨ workflow_loop ä¸­è°ƒç”¨
_validate_tdd_rules(
   decision=decision,
   must_test_after_dev=must_test_after_dev,
   test_required_tasks=test_required_tasks,
)

å·¥ä½œé‡ï¼š2-3 å°æ—¶

---
2. å®ç° test_required å­—æ®µæ£€æµ‹ â­â­â­â­

ä½ç½®ï¼šorchestrator/workflow.py

éœ€è¦æ·»åŠ ï¼š
def _check_test_required_tasks(dev_plan_text: str) -> bool:
   """
   æ£€æŸ¥ dev_plan ä¸­æ˜¯å¦æœ‰ test_required: true çš„æœªå®Œæˆä»»åŠ¡
   
   è¿”å› True å¦‚æœå­˜åœ¨éœ€è¦å…ˆå†™æµ‹è¯•çš„ä»»åŠ¡
   """
   import re

   # åŒ¹é…ä»»åŠ¡å—
   task_pattern = r'###\s+M\d+-T\d+:.*?(?=###|\Z)'
   tasks = re.findall(task_pattern, dev_plan_text, re.DOTALL)

   for task in tasks:
         # æå– status å’Œ test_required
         status_match = re.search(r'-\s*status:\s*(\w+)', task)
         test_req_match = re.search(r'-\s*test_required:\s*(true|false)', task)

         if status_match and test_req_match:
            status = status_match.group(1)
            test_required = test_req_match.group(1) == 'true'

            # å¦‚æœä»»åŠ¡æœªå®Œæˆä¸”éœ€è¦æµ‹è¯•
            if status in {'TODO', 'DOING', 'BLOCKED'} and test_required:
               return True

   return False

# åœ¨ workflow_loop ä¸­ä½¿ç”¨
test_required_tasks = _check_test_required_tasks(dev_plan_text)
if test_required_tasks:
   extra_instructions.append(
         "ã€TDD å¼ºåˆ¶è§„åˆ™ã€‘æ£€æµ‹åˆ° test_required=true çš„æœªå®Œæˆä»»åŠ¡ï¼Œ"
         "å¿…é¡»å…ˆæ´¾å‘ TEST ç¼–å†™æµ‹è¯•ç”¨ä¾‹ï¼ˆé¢„æœŸå¤±è´¥ï¼‰ï¼Œå†æ´¾å‘ DEV å®ç°ã€‚"
   )

å·¥ä½œé‡ï¼š3-4 å°æ—¶

---
P1 - é«˜ä¼˜å…ˆçº§ï¼ˆæœ¬å‘¨å†…å®Œæˆï¼‰

3. å¢å¼º DEV ä»£ç†çº¦æŸ â­â­â­â­

ä½ç½®ï¼šorchestrator/memory/prompts/subagent_prompt_dev.md

éœ€è¦æ·»åŠ ï¼š
## ç¦æ­¢äº‹é¡¹ï¼ˆå¼ºåˆ¶ï¼‰

ä»¥ä¸‹è¡Œä¸ºæ˜¯**ä¸¥æ ¼ç¦æ­¢**çš„ï¼Œè¿åå°†å¯¼è‡´ä»»åŠ¡å¤±è´¥ï¼š

1. âŒ **ç¦æ­¢è·³è¿‡æµ‹è¯•**
   - å³ä½¿ä½ è®¤ä¸º"ä»£ç å¾ˆç®€å•ä¸éœ€è¦æµ‹è¯•"ï¼Œä¹Ÿå¿…é¡»è¿è¡Œæµ‹è¯•
   - å³ä½¿æ—¶é—´ç´§è¿«ï¼Œä¹Ÿä¸èƒ½è·³è¿‡æµ‹è¯•
   - å¦‚æœæµ‹è¯•ä¸å­˜åœ¨ï¼Œå¿…é¡»åœ¨æŠ¥å‘Šä¸­æ ‡è®°ä¸ºé˜»å¡

2. âŒ **ç¦æ­¢ä¿®æ”¹æµ‹è¯•ä»£ç **
   - é™¤é MAIN æ˜ç¡®è¦æ±‚"ä¿®å¤æµ‹è¯•"
   - ä¸å…è®¸ä¸ºäº†è®©æµ‹è¯•é€šè¿‡è€Œä¿®æ”¹æµ‹è¯•
   - ä¸å…è®¸åˆ é™¤æˆ–æ³¨é‡Šæ‰å¤±è´¥çš„æµ‹è¯•

3. âŒ **ç¦æ­¢è™šå‡å£°ç§°"å·²æµ‹è¯•"**
   - ä¸å…è®¸åœ¨æŠ¥å‘Šä¸­å£°ç§°"å·²æµ‹è¯•"è€Œæ²¡æœ‰è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
   - æ‰‹åŠ¨éªŒè¯ä¸ç®—æµ‹è¯•
   - å¿…é¡»æä¾›æµ‹è¯•è¿è¡Œçš„è¯æ®ï¼ˆè¾“å‡ºã€è¦†ç›–ç‡æŠ¥å‘Šï¼‰

## æŠ¥å‘Šè¦æ±‚ï¼ˆå¼ºåˆ¶ï¼‰

ä½ çš„æŠ¥å‘Š**å¿…é¡»**åŒ…å«ä»¥ä¸‹ç« èŠ‚ï¼š

### æµ‹è¯•è¿è¡Œç»“æœ
- è¿è¡Œçš„æµ‹è¯•å‘½ä»¤ï¼š`pytest tests/test_xxx.py -v`
- æµ‹è¯•é€šè¿‡ç‡ï¼šX/Y passed
- æµ‹è¯•è¦†ç›–ç‡ï¼šX%ï¼ˆå¦‚æœå¯ç”¨ï¼‰
- å¤±è´¥çš„æµ‹è¯•ï¼šåˆ—å‡ºå¤±è´¥çš„æµ‹è¯•åç§°å’ŒåŸå› 

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œå¿…é¡»åœ¨æŠ¥å‘Šä¸­æ ‡è®°ä¸º**é˜»å¡**ã€‚

å·¥ä½œé‡ï¼š1-2 å°æ—¶

---
4. ç¼–å†™å•å…ƒæµ‹è¯• â­â­â­â­

ä½ç½®ï¼šorchestrator/tests/test_repo_changes.pyï¼ˆæ–°å»ºï¼‰

éœ€è¦æµ‹è¯•ï¼š
- capture_dirty_file_digests() - å„ç§ git çŠ¶æ€
- diff_dirty_file_digests() - å‰åå¯¹æ¯”
- _write_stage_changes() - JSON å†™å…¥
- _load_stage_changes() - JSON è¯»å–
- _validate_tdd_rules() - è§„åˆ™éªŒè¯

å·¥ä½œé‡ï¼š4-6 å°æ—¶

---
P2 - ä¸­ä¼˜å…ˆçº§ï¼ˆä¸‹å‘¨å®Œæˆï¼‰

5. å®ç°æµ‹è¯•è¦†ç›–ç‡é—¨ç¦ â­â­â­

éœ€è¦ä¿®æ”¹ï¼š
1. orchestrator/memory/verification_policy.json - æ·»åŠ è¦†ç›–ç‡è¦æ±‚
2. orchestrator/validation.py - å®ç°è¦†ç›–ç‡æ£€æŸ¥å‡½æ•°
3. orchestrator/workflow.py - åœ¨ REVIEW åæ£€æŸ¥è¦†ç›–ç‡

å·¥ä½œé‡ï¼š6-8 å°æ—¶

---
6. å®ç° dev_plan ç»“æ„æ‰©å±• â­â­

éœ€è¦ä¿®æ”¹ï¼š
1. è®¾è®¡æ–°çš„ä»»åŠ¡ç»“æ„ï¼ˆæµ‹è¯•é˜¶æ®µã€å®ç°é˜¶æ®µã€å®¡é˜…é˜¶æ®µï¼‰
2. ä¿®æ”¹ validation.py æ”¯æŒæ–°æ—§æ ¼å¼
3. ç¼–å†™è¿ç§»è„šæœ¬

å·¥ä½œé‡ï¼š8-10 å°æ—¶

---
ğŸ¯ æ€»ç»“

å½“å‰çŠ¶æ€ï¼šéƒ¨åˆ†å®Œæˆï¼Œä½†æ ¸å¿ƒæœºåˆ¶ç¼ºå¤±

å®Œæˆåº¦ï¼š
- ä»£ç å˜æ›´è·Ÿè¸ªï¼šâœ… 100%
- MAIN å†³ç­–è§„åˆ™ï¼šâœ… 80%ï¼ˆç¼ºå°‘éªŒè¯ï¼‰
- Workflow é›†æˆï¼šâœ… 70%ï¼ˆç¼ºå°‘å¼ºåˆ¶é€»è¾‘ï¼‰
- DEV/TEST çº¦æŸï¼šâš ï¸ 50%ï¼ˆç¼ºå°‘ç¦æ­¢äº‹é¡¹ï¼‰
- æµ‹è¯•è¦†ç›–ç‡é—¨ç¦ï¼šâŒ 0%
- dev_plan ç»“æ„æ‰©å±•ï¼šâŒ 0%
- å•å…ƒæµ‹è¯•ï¼šâŒ 0%

æ€»ä½“å®Œæˆåº¦ï¼š40%

æœ€ä¸¥é‡çš„é—®é¢˜

è‡´å‘½ç¼ºé™·ï¼šmust_test_after_dev å˜é‡è®¾ç½®åæ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¯¼è‡´ TDD è§„åˆ™å®Œå…¨ä¾èµ– MAIN ä»£ç†çš„"è‡ªè§‰æ€§"ï¼Œæ²¡æœ‰ç¡¬ç¼–ç å¼ºåˆ¶æœºåˆ¶ã€‚

å»ºè®®ï¼šç«‹å³ä¿®å¤ P0 é—®é¢˜ï¼Œå¦åˆ™æ•´ä¸ª TDD ä¿®å¤å½¢åŒè™šè®¾ã€‚