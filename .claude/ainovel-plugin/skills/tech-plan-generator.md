---
skill_name: tech-plan-generator
version: 1.0.0
description: Generate comprehensive technical plan documents following standardized structure (~1000 lines)
when_to_use: |
  Use this skill when the user needs to generate technical plan documents, including:
  - System refactoring plans
  - New feature design documents
  - Architecture upgrade plans
  - Technology selection documents

  Trigger phrases: "生成技术方案", "写技术文档", "生成设计方案", "重构方案", "generate tech plan"
---

# Tech Plan Generator Skill

当用户需要生成技术方案文档时使用此 skill。

## 使用场景

- 生成系统重构方案
- 生成新功能设计方案
- 生成架构升级方案
- 生成技术选型方案

## 文档标准结构（总计约1000行）

### 一、执行摘要（~100行）

#### 1.1 项目目标
- 明确说明要解决的问题
- 列出核心目标（3-5个）
- 使用量化指标（如：性能提升X倍，功能完整性X%）

#### 1.2 核心问题分析
- 使用表格对比当前状态 vs 目标状态
- 列出功能缺失清单（带状态标记 ✅ ❌ ⚠️）
- 说明问题的影响范围和严重程度

#### 1.3 预期收益
- 功能完整性提升
- 性能指标改善
- 成本优化
- 用户体验提升
- 使用具体数字和百分比

#### 1.4 技术栈决策
- 使用表格对比技术选型（当前 vs 目标 vs 理由）
- 说明每个技术选择的关键优势
- 列出版本要求

---

### 二、架构设计要点（~150行）

#### 2.1 整体架构
- 使用 ASCII 图或文字描述架构层次
- 说明各层职责和交互关系
- 标注关键组件

#### 2.2 数据模型设计要点
- 列出核心实体/节点（名称、用途、关键属性）
- 列出核心关系/边（类型、属性、约束）
- **不写完整的类定义代码**
- 只列出关键字段和索引策略

#### 2.3 核心机制设计
- 说明关键技术机制（如：时序边、快照、消解等）
- 列出设计原则和约束
- 说明与其他组件的交互

#### 2.4 索引和优化策略
- 列出必须建立的索引（表格形式）
- 说明查询优化模式
- 标注性能关键点

---

### 三、核心功能实现要点（~200行）

每个核心功能按以下格式描述：

#### 3.X 功能名称

**功能描述**：一句话说明功能用途

**实现步骤**：
1. 步骤1：做什么
2. 步骤2：做什么
3. ...

**关键点**：
- 关键点1：技术要点或注意事项
- 关键点2：...

**性能优化**：
- 优化策略1
- 优化策略2

**输入输出**：
- 输入：参数说明
- 输出：返回值说明

**注意事项**：
- 边界条件
- 错误处理
- 并发控制

**不包含**：
- ❌ 完整的函数实现代码
- ❌ 详细的类定义
- ❌ 具体的 SQL/Cypher 查询（除非是关键查询模式）

---

### 四、TDD 测试规范（~150行）

#### 4.1 测试分层策略
- E2E Tests：端到端场景
- Integration Tests：组件集成
- Unit Tests：单元逻辑

#### 4.2 核心测试用例

每个测试用例使用以下格式：

**测试X: 测试名称**
- Given: 前置条件
- When: 执行操作
- Then: 预期结果

**验收条件**：
- ✅ 条件1
- ✅ 条件2

**不包含**：
- ❌ 完整的测试代码实现
- ❌ 具体的 pytest 函数

#### 4.3 测试覆盖率要求
- 使用表格列出各模块的覆盖率目标
- 单元测试、集成测试、E2E测试分别要求

#### 4.4 CI/CD 集成要点
- 列出关键的 CI 步骤
- 说明测试触发条件
- 不包含完整的 YAML 配置

---

### 五、实施计划（~200行）

#### 5.1 总体时间线
- 使用 ASCII 图或文字描述周计划
- 标注关键里程碑

#### 5.2 分周任务（Week 1-5）

每周按以下格式：

**Week X: 阶段名称**

**目标**：本周要达成的目标

**任务清单**：
使用表格列出：
| 任务 | 负责人 | 工作量 | 优先级 |

**交付物**：
- 交付物1：文件路径或组件名称
- 交付物2：...

**验收标准**：
- ✅ 标准1
- ✅ 标准2

**不包含**：
- ❌ 详细的代码文件内容
- ❌ 完整的脚本实现

---

### 六、风险管理（~50行）

#### 6.1 技术风险
使用表格：
| 风险 | 概率 | 影响 | 缓解措施 | 应急方案 |

#### 6.2 项目风险
同上格式

#### 6.3 回滚计划
- 列出回滚步骤（1-5步）
- 说明回滚触发条件
- 标注回滚验证方法

---

### 七、成功标准（~50行）

#### 7.1 功能完整性
- 列出功能清单和实现百分比
- 总体功能完整性目标

#### 7.2 性能指标
使用表格：
| 指标 | 目标 | 测试方法 |

#### 7.3 质量指标
同上格式

#### 7.4 用户体验指标
同上格式

---

### 八、关键实现细节（~100行）

#### 8.1 并发控制策略
- 列出并发控制机制（乐观锁、连接池等）
- 说明配置参数
- 不包含完整实现代码

#### 8.2 查询优化策略
- 列出关键查询的优化方向
- 说明索引使用策略
- 标注性能目标

#### 8.3 数据迁移策略
- 列出迁移步骤（5-10步）
- 说明验证方法
- 标注回滚步骤

#### 8.4 监控与告警
- 列出关键监控指标
- 说明告警规则
- 使用表格展示阈值

---

### 九、总结与建议（~50行）

#### 9.1 方案必要性
- 评级（⭐⭐⭐⭐⭐）
- 3-5点理由

#### 9.2 技术可行性
- 评级（⭐⭐⭐⭐）
- 3-5点支撑

#### 9.3 实施建议
- 3-5条关键建议

#### 9.4 长期规划
- 列出方案完成后的系统能力（5-8点）

---

## 写作规范

### 1. 格式要求

- **使用 Markdown 格式**
- **标题层级**：# 一级（章） ## 二级（节） ### 三级（小节） #### 四级（条目）
- **表格**：用于对比、清单、指标
- **列表**：用于步骤、要点、条件
- **符号**：✅ ❌ ⚠️ ⭐ 用于状态标记
- **强调**：**粗体** 用于关键术语，`代码格式` 用于技术名词

### 2. 内容原则

#### 必须包含
- ✅ 设计思路和实现步骤
- ✅ 关键技术决策和理由
- ✅ 架构设计要点
- ✅ 测试验收标准
- ✅ 实施计划和交付物
- ✅ 风险管理和回滚方案
- ✅ 量化的成功指标

#### 必须避免
- ❌ 完整的代码实现（函数、类、配置文件）
- ❌ 超过 20 行的代码块
- ❌ 冗长的背景介绍
- ❌ 重复的概念解释
- ❌ 过度详细的示例代码

#### 代码使用规则
- 只在必要时使用代码片段（< 10 行）
- 用于展示关键查询模式、数据结构、配置示例
- 使用伪代码或简化代码
- 用注释说明关键逻辑

### 3. 行数控制

- **总行数目标**：900-1100 行
- **章节比例**：
  - 执行摘要：10%
  - 架构设计：15%
  - 功能实现：20%
  - 测试规范：15%
  - 实施计划：20%
  - 风险管理：5%
  - 成功标准：5%
  - 实现细节：10%

### 4. 语言风格

- **简洁明确**：避免冗长描述，直接说明要点
- **结构化**：多用列表和表格，少用大段文字
- **可执行**：开发人员能根据文档直接实施
- **量化**：使用具体数字和百分比
- **专业**：使用准确的技术术语

### 5. 质量检查清单

生成文档后，检查是否满足：

- ✅ 总行数在 900-1100 行之间
- ✅ 包含完整的九个章节
- ✅ 每个核心功能都有实现要点
- ✅ 每个功能都有对应的测试用例
- ✅ 实施计划包含交付物和验收标准
- ✅ 风险管理包含应急方案
- ✅ 成功标准可量化可测试
- ✅ 无完整的代码实现（除必要的简短示例）
- ✅ 表格和列表格式正确
- ✅ 文档结构清晰易导航

---

## 执行流程

当用户请求生成技术方案时，按以下步骤执行：

### Step 1: 需求分析
1. 识别方案类型（重构/新功能/优化/迁移）
2. 确认项目背景和目标
3. 了解技术栈和约束条件
4. 确定文档保存路径（使用绝对路径）

### Step 2: 信息收集
1. 如果是重构方案，分析现有代码结构
2. 如果是新功能，了解需求和用户场景
3. 收集相关技术文档和参考资料
4. 确定关键技术决策点

### Step 3: 文档生成
1. 按照九章标准结构生成内容
2. 严格控制每章行数比例
3. 使用表格、列表、符号增强可读性
4. 避免完整代码实现，聚焦设计思路
5. 确保所有指标可量化可测试

### Step 4: 质量检查
1. 检查总行数是否在 900-1100 行
2. 验证九个章节是否完整
3. 确认无完整代码实现
4. 检查表格和列表格式
5. 验证量化指标的合理性

### Step 5: 文档保存
1. 使用绝对路径保存文档
2. 文件命名遵循规范：
   - 重构方案：`{component}_refactor_plan.md`
   - 新功能设计：`{feature}_design.md`
   - 技术选型：`{tech}_selection.md`
   - 优化方案：`{module}_optimization.md`
3. 默认保存到 `/home/zxh/ainovel_v3/doc/` 目录
4. 向用户确认文档已生成并提供路径

---

## 使用示例

### 示例 1：生成重构方案

**用户输入**：
```
生成图数据库重构方案，从 Kùzu 迁移到 Memgraph，实现时序状态追踪和实体消解功能
```

**助手执行**：
1. 分析需求：重构方案，涉及数据库迁移、新功能实现
2. 按照标准结构生成文档：
   - 执行摘要：说明重构目标、当前问题、预期收益
   - 架构设计：双子图架构、时序边设计、索引策略
   - 功能实现：时序边失效、实体消解、影响分析（只写实现步骤）
   - 测试规范：核心测试用例（Given-When-Then）
   - 实施计划：5周计划，每周任务和交付物
   - 风险管理：技术风险、回滚计划
   - 成功标准：功能、性能、质量指标
3. 控制行数在 1000 行左右
4. 保存到 `/home/zxh/ainovel_v3/doc/graph_refactor_plan.md`

### 示例 2：生成新功能设计

**用户输入**：
```
设计一个智能推荐系统，基于用户行为和内容相似度推荐小说章节
```

**助手执行**：
1. 分析需求：新功能设计，涉及推荐算法、数据模型
2. 按照标准结构生成文档
3. 重点在功能实现和算法设计要点
4. 包含 A/B 测试方案
5. 保存到 `/home/zxh/ainovel_v3/doc/recommendation_system_design.md`

---

## 模板变量

生成文档时，根据具体项目调整以下内容：

- **项目名称**：如 "AI Novel V3.0"
- **方案类型**：重构/新功能/优化/迁移
- **技术栈**：具体的技术选型
- **时间周期**：3周/5周/8周
- **团队规模**：影响工作量估算
- **优先级**：P0/P1/P2 标记

---

## 重要提醒

### 对助手的要求

1. **必须使用绝对路径**：所有文件路径必须使用绝对路径，如 `/home/zxh/ainovel_v3/doc/xxx.md`
2. **严格控制行数**：总行数必须在 900-1100 行之间
3. **避免代码实现**：这是设计文档，不是代码文档
4. **聚焦设计思路**：说明"做什么"和"为什么"，而不是"怎么写代码"
5. **保持可执行性**：开发人员能根据文档实施，但不是照抄代码
6. **使用标准结构**：保持九个章节的标准格式
7. **量化指标**：所有目标都要有可测量的指标
8. **风险意识**：必须包含风险管理和回滚方案

### 文档质量标准

- ✅ 结构完整：九个章节齐全
- ✅ 行数合理：900-1100 行
- ✅ 格式规范：Markdown 格式正确
- ✅ 内容精炼：无冗余描述
- ✅ 可执行性：开发人员能直接实施
- ✅ 量化指标：所有目标可测量
- ✅ 风险管理：包含应急方案
- ✅ 无代码实现：只有必要的简短示例

---

## 工具使用

生成文档时，助手应使用以下工具：

1. **Read**：读取现有代码和文档
2. **Grep**：搜索相关代码模式
3. **Glob**：查找相关文件
4. **Write**：生成并保存文档（使用绝对路径）
5. **TodoWrite**：跟踪文档生成进度

不应使用的工具：
- ❌ Edit：不编辑现有代码
- ❌ Bash（除非必要）：不执行代码
- ❌ NotebookEdit：不涉及 Jupyter

---

## 结束语

此 skill 旨在帮助团队快速生成高质量的技术方案文档，确保：
- 设计思路清晰
- 实施计划可行
- 风险管理完善
- 成功标准明确

通过标准化的文档结构和严格的质量控制，提升技术方案的可执行性和团队协作效率。
