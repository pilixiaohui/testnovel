FROM node:20-bookworm-slim
RUN apt-get update && apt-get install -y python3 python3-pip git curl && rm -rf /var/lib/apt/lists/*
# 同时安装 Codex 与 Claude Code CLI，避免 role 切换时镜像缺少对应命令
RUN npm install -g @openai/codex@0.101.0 @anthropic-ai/claude-code @fission-ai/openspec
RUN pip3 install --no-cache-dir --break-system-packages anthropic
WORKDIR /workspace
COPY orchestrator_v2/ /opt/orchestrator_v2/
ENV PYTHONPATH=/opt
ENTRYPOINT ["python3", "-m", "orchestrator_v2.harness.entrypoint", "agent"]
