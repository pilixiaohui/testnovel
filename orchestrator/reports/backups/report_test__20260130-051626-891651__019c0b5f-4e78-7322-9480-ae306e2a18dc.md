已阅读测试行为规范
iteration: 12

## 测试需求分析

工单要求测试的功能点：
1. POST /api/v1/chapters/{chapter_id}/render 端点存在
2. 成功调用返回200和rendered_content字段
3. rendered_content字数在1800-2200范围内
4. chapter_id不存在时返回404
5. 渲染失败时返回适当错误码

## 测试设计

### 设计思路
使用 FastAPI TestClient 做集成级调用，依赖注入 DummyStorage + FlexibleRenderer 控制章节存在性与渲染结果，覆盖成功、缺失、失败三类路径，并显式校验 rendered_content 字段与字数范围。

### 创建的测试文件
- `project/backend/tests/integration/test_chapter_render_api.py` - 章节渲染API集成测试

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| test_chapter_render_success_returns_content_and_word_count | 正常流程 | 功能点1/2/3 | 调用渲染端点，断言200、返回rendered_content且字数在范围内 |
| test_chapter_render_missing_chapter_returns_404 | 章节不存在 | 功能点4 | storage返回None，断言404 |
| test_chapter_render_failure_returns_400 | 渲染失败 | 功能点5 | renderer抛ValueError，断言400 |

### 关键测试逻辑
- 测试数据如何准备：构造Chapter模型对象，renderer返回固定长度(1900)文本。
- 调用什么接口/函数：POST `/api/v1/chapters/{chapter_id}/render`。
- 断言什么条件：200/404/400状态码；rendered_content存在且长度在1800-2200。
- 为什么这样设计能验证需求：三类路径覆盖端点存在性、成功输出与异常处理。

## 测试执行

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/integration/test_chapter_render_api.py -v`
- 结果: 失败
- 红灯确认: 是（端点未实现导致返回404）

### 执行详情
- 失败用例：
  - `test_chapter_render_success_returns_content_and_word_count`：期望200，实际404（端点缺失）
  - `test_chapter_render_failure_returns_400`：期望400，实际404（端点缺失）
- 通过用例：
  - `test_chapter_render_missing_chapter_returns_404`

## 验收标准

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/integration/test_chapter_render_api.py -v`
- 阈值: 测试文件存在、可运行，未实现时应红灯

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena
触发: 读取主路由与存储/渲染相关位置并编写/执行集成测试
参数: search_for_pattern, create_text_file, execute_shell_command（max_answer_chars: -1）
结果: 新增测试文件1个；执行1次，红灯2处
状态: 成功