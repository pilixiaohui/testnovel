已阅读开发行为规范  
iteration: 7  
self_test: enabled

## 任务理解

工单要求实现的功能：
1. 新增章节审核 API：`POST /api/v1/chapters/{chapter_id}/review`。
2. 手动校验 `status` 为 `approved|rejected`，非法状态返回 400（避免 422）。
3. 章节不存在返回 404，并持久化 `review_status`。

## 实现方案

### 设计思路
在现有章节路由附近新增最小接口，复用存储更新逻辑，采用显式状态校验以保证 400 行为，保持快速失败与最小改动。

### 改动说明

| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/backend/app/models.py:161` | 新增 `ChapterReviewPayload` | 使用 `status: str`，避免 Pydantic 触发 422 |
| `project/backend/app/main.py:22` | 引入 `ChapterReviewPayload`、`ReviewStatus` | 供新接口使用 |
| `project/backend/app/main.py:656` | 新增 `/chapters/{id}/review` 端点 | 手动校验 status→更新 review_status→返回确认 |

### 关键实现逻辑
- 数据流向：请求体 → `payload.status` → 手动校验 → `storage.get_chapter` → `review_status` 更新 → `storage.update_chapter` → 返回确认。
- 关键算法/处理步骤：`status` 必须是 `approved/rejected`，否则直接 400。
- 异常处理策略：章节不存在 404；非法状态 400；存储层 `KeyError/ValueError` 继续映射为 404/400（保持快速失败）。
- 与其他模块的交互方式：复用 `GraphStoragePort.update_chapter` 持久化审核状态。

## 自测结果（仅 enabled 模式）

### 验收结果汇总

| 序号 | 命令 | 返回码 | 结果摘要 |
|-----|------|-------|---------|
| 1 | `/home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/integration/test_chapter_review_api.py -v` | 0 | 5 passed, 2 warnings |

- 全部验收命令已执行: 是
- 自测结果: PASS
- 覆盖率: 未输出（该命令未生成覆盖率）

### 测试详情
章节审核 API 相关 5 个用例全部通过；FastAPI `on_event` 存在弃用警告（未影响本次任务）。

## 测试问题反馈（如有）
无

## 总结与展望
- 已完成核心任务：新增章节审核 API，支持 `approved/rejected` 状态并持久化。
- 原则应用：  
  - KISS：只增加必要端点与模型。  
  - YAGNI：不引入额外配置或扩展状态。  
  - DRY：复用现有存储更新逻辑。  
  - SOLID（SRP）：请求模型与业务逻辑分离。  
- 挑战：确保无效状态返回 400 而非 422；通过手动校验解决。  
- 下一步建议：如需更严格校验，可在文档中明确状态字段规范并同步前端校验。

结论：PASS  
阻塞：无

【MCP调用简报】  
服务: serena  
触发: 代码阅读、修改与测试  
参数: read_file / replace_regex / execute_shell_command（max_answer_chars=-1）  
结果: 新增审核请求模型与接口，pytest 5 passed  
状态: 成功