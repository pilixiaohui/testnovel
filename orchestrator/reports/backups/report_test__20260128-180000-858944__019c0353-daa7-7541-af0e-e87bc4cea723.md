已阅读测试行为规范  
iteration: 14

## 测试需求分析

工单要求测试的功能点：
1. 加载场景：UI 触发加载后调用 scene API（context/render），编辑器展示内容更新。
2. 编辑与保存：修改 summary/outcome 后点击保存，调用 update API，状态与 UI 同步。
3. diff/render/dirty：触发 diff 与 render，dirty 标记更新。
4. 失败路径：API 失败时不应推进状态（快速失败）。

## 测试设计

### 设计思路
- 在 `test:integration` 目标文件内新增 SceneEditor 的 UI 集成测试。
- 通过 data-test 选择器驱动加载/保存/diff/render 交互，断言 API 调用与 UI 反馈。
- 预期当前未接入时出现红灯（UI 入口缺失或 API 未被调用）。

### 创建的测试文件
- `project/frontend/tests/fe_core_views_contract.spec.ts:1` - 增加 M2-T2 SceneEditor UI 触发集成测试（保留既有测试）。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| loads scene context/render via UI | 正常流程 | 功能点1 | 点击加载按钮，期望调用 context/render API 并更新展示 |
| edits summary/outcome and saves via update API | 正常流程 | 功能点2 | 修改 summary/outcome 后保存，期望调用 update API |
| updates diff/render and dirty flag | 正常流程 | 功能点3 | 触发 diff/render，期望 dirty 指示出现 |
| does not advance when load API fails | 异常处理 | 功能点4 | load API 失败后状态不推进 |

### 关键测试逻辑
- 测试数据准备：mock `fetchSceneContext/renderScene/updateScene/diffScene` 返回值。
- 调用接口/函数：通过 UI 选择器（`scene-load`、`scene-summary-input`、`scene-outcome-select`、`scene-diff`、`scene-render`）触发动作。
- 断言条件：API mock 被调用、UI/dirty 指示存在；失败路径下不推进。
- 设计理由：覆盖 UI→API→状态/展示的关键链路，确保未接入时红灯。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npm run test:integration`
- 结果: 失败
- 红灯确认: 是（AssertionError，UI 未接入导致）

### 执行详情
- 失败用例（均为断言失败）：
  - `loads scene context/render via UI`：`[data-test="scene-load"]` 不存在。
  - `edits summary/outcome and saves via update API`：`[data-test="scene-summary-input"]` 不存在。
  - `updates diff/render and dirty flag`：`[data-test="scene-diff"]` 不存在。
  - `does not advance when load API fails`：`[data-test="scene-load"]` 不存在。
- 失败原因：SceneEditor 当前无对应 UI 入口/绑定，未触发 API 调用链路。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 阈值: 测试可运行且覆盖上述场景，当前应为红灯（实现前）

结论：PASS  
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取工单与被测代码、更新测试、执行集成测试  
参数: read_file, create_text_file, execute_shell_command  
结果: 更新 `project/frontend/tests/fe_core_views_contract.spec.ts:1`；`npm run test:integration` 红灯确认  
状态: 成功