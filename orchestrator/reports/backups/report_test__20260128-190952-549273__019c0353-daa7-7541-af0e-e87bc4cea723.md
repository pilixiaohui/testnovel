已阅读测试行为规范
iteration: 20

## 测试需求分析

工单要求测试的功能点：
1. SnowflakeFlow：idea→logline→root→角色/场景/幕章/锚点，UI 与请求链路断言
2. SimulationConsole：加载场景→运行回合/场景→日志与收敛指示更新
3. SceneEditor：加载→编辑 summary/outcome→保存→diff/render/dirty 流程
4. WorldManager：实体/关系/锚点/支线加载与 CRUD；关系图谱渲染
5. Settings：配置项保存与提示

## 测试设计

### 设计思路
- 采用 Playwright E2E，按路由访问真实页面，使用 `data-test` 选择器驱动交互。
- 通过 `page.route` mock API 响应，确保 UI 流程可推进且可断言请求链路与状态变化。
- Settings 流程断言保存按钮与提示，当前实现缺失应触发红灯。

### 创建的测试文件
- `project/frontend/tests/e2e/core.e2e.spec.ts:1` - 新增 Playwright E2E 覆盖 5 个核心流程，内含本地 dev server 启动与 API mock。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| SnowflakeFlow 核心流程 | 正常流程 | 功能点1 | 按步骤点击触发 API，断言请求与 UI 文案变化 |
| SimulationConsole 核心流程 | 正常流程 | 功能点2 | Start/Step/Scene 触发 API，断言日志与收敛标记 |
| SceneEditor 核心流程 | 正常流程 | 功能点3 | Load/编辑/Save/Diff/Render，断言 dirty 与输出 |
| WorldManager 核心流程 | 正常流程 | 功能点4 | Load/CRUD/Relations，断言请求与列表/图谱展示 |
| Settings 保存流程 | 缺失功能 | 功能点5 | 断言保存按钮存在与提示（当前应失败） |

### 关键测试逻辑
- 测试数据准备：在每个用例前 `page.route` mock 相关 API（Snowflake/Simulation/Scene/World），返回最小可用数据。
- 调用接口/函数：通过 UI 点击触发请求，使用 `page.waitForRequest` 验证链路。
- 断言条件：检查页面 `data-test` 元素、文本内容、log 数量、dirty 标记与图谱区域可见性。
- 设计理由：覆盖真实 UI 交互路径，验证“点击→请求→状态/UI”闭环；Settings 断言缺失用于红灯。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npx playwright test`
- 结果: 错误
- 红灯确认: 否（测试框架未启动浏览器）

### 执行详情
- Playwright 报错：`Executable doesn't exist ... chrome-headless-shell`，提示需要 `npx playwright install`。
- 尝试执行 `npx playwright install chromium` 两次均超时（120s / 180s），无法完成浏览器安装。
- 因环境问题导致用例未运行，无法进入预期红灯阶段。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test`
- 阈值: 测试可运行且覆盖上述场景（实现前应为红灯）

结论：BLOCKED
阻塞：环境问题（Playwright 浏览器未安装，安装超时）

【MCP调用简报】
服务: serena
触发: 读取工单、浏览视图/路由/接口、创建 E2E 测试文件
参数: relative_path=orchestrator/workspace/test/current_task.md 等；relative_path=project/frontend/tests/e2e/core.e2e.spec.ts
结果: 已获取所需文件信息并生成 E2E 测试
状态: 成功