已阅读审阅行为规范
iteration: 1
review_mode: single

## 任务理解

审阅的任务：阅读需求文档、审阅前后端代码现状、输出需求覆盖度与缺口清单、提出 dev_plan 里程碑/任务拆分（含验收命令/阈值）、明确前端 Playwright 测试范围与验收命令。  
验收标准：报告包含需求要点摘要、当前实现状态、缺口列表、建议里程碑/任务（含 acceptance 命令）、Playwright 测试建议；如有阻塞需明确阻塞类型与澄清问题。

## 验收执行

- 验收命令: 未提供（工单未给出验收命令）
- 返回码: N/A
- 测试结果: N/A
- 覆盖率: N/A

## 证据分析

### 执行输出
未执行命令：工单未提供验收命令，且本轮任务为审阅与报告输出。

### 代码审查

#### 需求要点摘要
- 前端：Vue3 + Vite + TS + ElementPlus + Pinia + Vue Router；API 必须通过 `src/api`，类型在 `src/types`，组件使用 `<script setup>`；需实现 Snowflake 6 步、Simulation、Editor、World、Settings 页面和配套组件。  
- 后端：FastAPI + Memgraph，包含 character_agent / world_master / simulation_engine / smart_renderer 等核心服务与 54 个 API 端点；测试分层（unit/integration/perf），覆盖率目标 ≥ 80%。  
- 测试：前端需 unit/integration/e2e；后端 pytest + 覆盖率；E2E 需 Playwright 全流程。

#### 当前实现状态（抽样证据）
- 后端核心服务与端点已落盘：  
  - DM 引擎与节奏/收敛/补路逻辑存在（`project/backend/app/services/world_master.py:1`）。  
  - 推演引擎存在并包含回合、收敛、补路与日志写入逻辑（`project/backend/app/services/simulation_engine.py:1`）。  
  - 关键端点（anchors、agent、dm、simulation、render 等）在 `main.py` 中已注册（`project/backend/app/main.py:605`、`project/backend/app/main.py:757`、`project/backend/app/main.py:859`、`project/backend/app/main.py:926`、`project/backend/app/main.py:973`、`project/backend/app/main.py:1048`）。  
  - 单元测试覆盖 world_master 等核心逻辑（`project/backend/tests/unit/test_world_master.py:1`）。
- 前端路由具备 6 个主路由（`project/frontend/src/router/index.ts:1`）。  
- 主要页面为静态占位：  
  - SnowflakeFlow 使用本地固定数据与本地 ref（`project/frontend/src/views/SnowflakeFlow.vue:1`）。  
  - SimulationConsole 使用静态队列与日志（`project/frontend/src/views/SimulationConsole.vue:1`）。  
  - SceneEditor / WorldManager 以固定样例数据渲染（`project/frontend/src/views/SceneEditor.vue:1`、`project/frontend/src/views/WorldManager.vue:1`）。  
  - Settings 为空占位（`project/frontend/src/views/SettingsView.vue:1`）。
- 组件与类型仍为简化/占位：  
  - 组件多为简化占位（如 `project/frontend/src/components/AnchorTimeline.vue:1`）。  
  - Snowflake 类型与需求中的 Root 结构不一致（`project/frontend/src/types/snowflake.ts:1`）。  
  - Snowflake Store 为“步骤备注”模型，未体现 Step1-6 API 动作（`project/frontend/src/stores/snowflake.ts:1`）。  
  - API 客户端 baseURL 硬编码为 `/api/v1`，未使用 `VITE_API_BASE_URL`（`project/frontend/src/api/index.ts:1`）。
- 前端测试与 E2E 现状：  
  - 单测仅验证 DOM contract（`project/frontend/tests/fe_core_views_contract.spec.ts:1`）。  
  - Playwright 文件为计划草稿且直接抛错（`project/frontend/tests/e2e/playwright.e2e.ts:1`）。  
  - `test:e2e` 仅输出 echo（`project/frontend/package.json:6`）。

#### 缺口列表（功能/接口/数据/页面/测试）
- 功能缺口  
  - Snowflake 6 步流程未接入 API 与 Pinia 状态，页面为静态示例（`project/frontend/src/views/SnowflakeFlow.vue:1`、`project/frontend/src/stores/snowflake.ts:1`）。  
  - SimulationConsole 未接入推演 API/状态，控制按钮无业务行为（`project/frontend/src/views/SimulationConsole.vue:1`）。  
  - SceneEditor 与 WorldManager 均为静态数据，未接入场景/世界观 API（`project/frontend/src/views/SceneEditor.vue:1`、`project/frontend/src/views/WorldManager.vue:1`）。  
  - Settings 页面为空占位（`project/frontend/src/views/SettingsView.vue:1`）。
- 接口缺口  
  - API baseURL 硬编码，未使用环境变量（`project/frontend/src/api/index.ts:1`）。  
  - 前端 API 模块与 Store/Views 未形成调用链（由视图静态数据可见，`project/frontend/src/views/SnowflakeFlow.vue:1` 等）。
- 数据缺口  
  - 前端 SnowflakeRoot/Step 数据结构与需求中的 Root/角色/场景契约不一致（`project/frontend/src/types/snowflake.ts:1`、`project/frontend/src/stores/snowflake.ts:1`）。
- 页面缺口  
  - 需求中的 Step1-6 面板、Simulation/Editor/World 的细分组件未落地，当前组件多为占位（`project/frontend/src/components/AnchorTimeline.vue:1`）。
- 测试缺口  
  - 前端仅有 DOM contract 测试，缺少 store/api/组件/流程级测试（`project/frontend/tests/fe_core_views_contract.spec.ts:1`）。  
  - E2E 为空壳，`test:e2e` 也未执行实际测试（`project/frontend/tests/e2e/playwright.e2e.ts:1`、`project/frontend/package.json:6`）。

## 结论

结论：PASS  
失败类型：N/A  
阻塞：无

## 建议

### 建议 dev_plan 里程碑与任务拆分（含验收命令/阈值）
- M1：前端契约对齐与基础设施  
  - T1：统一 `types/` 与 `stores/` 数据结构，补齐 Snowflake/Simulation/World 契约；API baseURL 改为 `VITE_API_BASE_URL || /api/v1`；组件目录按 snowflake/simulation/editor/world 分域重组。  
    - 验收命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit`  
    - 覆盖率阈值: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage`（coverage ≥ 80%）
  - T2：Snowflake Step1-6 全流程（logline → root → character → scenes → acts/chapters → anchors），完成组件与 store 行为，接入 `snowflakeApi/anchorApi`。  
    - 验收命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`  
    - 覆盖率阈值: `npm run test:coverage`（coverage ≥ 80%）
- M2：Simulation / Editor / World 三大页面接入  
  - T1：SimulationConsole 接入推演 API、agent 状态、裁决与收敛面板组件。  
  - T2：SceneEditor 接入 scene API（context/render/diff/complete/dirty）与版本对比组件。  
  - T3：WorldManager 接入 entity/anchor/subplot API 与关系图谱组件。  
    - 验收命令（建议统一）：`cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit` + `npm run test:integration`  
    - 覆盖率阈值：`npm run test:coverage`（coverage ≥ 80%）
- M3：E2E 与 Playwright  
  - T1：将 `tests/e2e/playwright.e2e.ts` 转为真实 Playwright 测试，`test:e2e` 改为 `playwright test`，移除抛错占位。  
    - 验收命令: `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test`
- M4：后端验证与覆盖率  
  - T1：后端全量单测 + 覆盖率（依赖 Memgraph）。  
    - 验收命令:  
      - `cd /home/zxh/ainovel_v3/project/backend && /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q -rs`  
      - `cd /home/zxh/ainovel_v3/project/backend && /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest --cov=app --cov-report=term`（coverage ≥ 80%）

### 前端 Playwright 测试范围与验收命令（建议）
- 范围建议  
  1) SnowflakeFlow：输入 idea → 生成 loglines → 选择 → 生成 root → 角色/场景/幕章/锚点完成，验证 UI 与 API 响应渲染  
  2) SimulationConsole：加载场景 → runRound / runScene → 日志与收敛指示更新  
  3) SceneEditor：加载场景 → 编辑 summary/outcome → 完成场景 → diff/render/dirty 流程  
  4) WorldManager：实体/关系/锚点/支线 CRUD 与 UI 更新  
  5) Settings：配置项保存与提示  
- 验收命令（前置：运行 dev/preview 服务）：  
  - `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test`  
  - 若使用脚本：`cd /home/zxh/ainovel_v3/project/frontend && npm run test:e2e`

【MCP调用简报】  
服务: serena  
触发: 读取需求、检查前后端结构与关键实现/测试现状  
参数: read_file/list_dir/search_for_pattern/execute_shell_command（含 max_answer_chars=-1）  
结果: 覆盖需求文档 2 份；提取前端视图/Store/API/测试与后端端点/服务/测试证据  
状态: 成功