已阅读测试行为规范  
iteration: 17

## 测试需求分析

工单要求测试的功能点：
1. 加载实体/锚点/支线：UI 触发加载后调用 API，列表与关系视图更新。
2. 新增/更新/删除：触发 CRUD 操作，调用对应 API，UI 与状态同步。
3. 关系图谱：触发关系展示，图谱数据更新。
4. 失败路径：API 失败时不应推进状态（快速失败）。

## 测试设计

### 设计思路
- 在 `test:integration` 目标文件内新增 WorldManager 的 UI 集成测试。
- 通过 data-test 选择器触发加载、CRUD、关系图谱等交互，断言 API 调用与 store/UI 更新。
- 预期当前未接入时出现红灯（UI 入口缺失或调用链未建立）。

### 创建的测试文件
- `project/frontend/tests/fe_core_views_contract.spec.ts:1` - 增加 M2-T3 WorldManager 集成测试（保留既有测试）。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| loads entities/anchors/subplots via UI and updates lists | 正常流程 | 功能点1 | 点击加载按钮，期望调用实体/锚点/支线 API 并更新列表 |
| creates, updates, and deletes entities via UI | 正常流程 | 功能点2 | 触发新增/更新/删除按钮，期望调用对应 API |
| renders relations graph data via UI | 正常流程 | 功能点3 | 触发关系图谱按钮，期望图谱数据渲染 |
| does not advance when load API fails | 异常处理 | 功能点4 | load 失败后状态不推进 |

### 关键测试逻辑
- 测试数据准备：模拟 entities/anchors/subplots/relations 的 API 返回值。
- 调用接口/函数：通过 `[data-test="world-load"]`、`world-entity-create/update/delete`、`world-relations-show` 触发交互。
- 断言条件：API mock 被调用、store 更新、图谱节点存在。
- 设计理由：覆盖 UI→API→store/视图的核心链路，确保未接入时红灯。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npm run test:integration`
- 结果: 失败
- 红灯确认: 是（AssertionError，UI 未接入导致）

### 执行详情
- 失败用例（均为断言失败）：
  - `loads entities/anchors/subplots via UI and updates lists`：`[data-test="world-load"]` 不存在。
  - `creates, updates, and deletes entities via UI`：`[data-test="world-entity-create"]` 不存在。
  - `renders relations graph data via UI`：`[data-test="world-relations-show"]` 不存在。
  - `does not advance when load API fails`：`[data-test="world-load"]` 不存在。
- 失败原因：WorldManager 当前未接入 CRUD/关系图谱/UI 触发入口。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 阈值: 测试可运行且覆盖上述场景，当前应为红灯（实现前）

结论：PASS  
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取工单/被测代码、更新测试、执行集成测试  
参数: read_file, create_text_file, execute_shell_command  
结果: 更新 `project/frontend/tests/fe_core_views_contract.spec.ts:1`；`npm run test:integration` 红灯确认  
状态: 成功