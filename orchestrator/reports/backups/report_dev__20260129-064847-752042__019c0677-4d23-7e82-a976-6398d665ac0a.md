已阅读开发行为规范
iteration: 11
self_test: enabled

## 任务理解

工单要求实现的功能：
1. 修复 `test:e2e` 脚本为实际执行 Playwright。
2. 修复 Vitest `@` alias 配置以解析 `src` 目录。
3. 前端 API 路径对齐后端规范（anchors/world/scenes 相关）。

## 实现方案

### 设计思路
- 直接对齐脚本与配置，不引入额外抽象（KISS/YAGNI）。
- API 调整集中在现有接口文件与调用方，保持职责清晰（SRP/DRY）。
- 缺失数据直接失败，不添加兜底逻辑（快速失败）。

### 改动说明

| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/frontend/package.json:12` | `test:e2e` 改为执行 `npx playwright test` | 修复脚本未执行测试的问题 |
| `project/frontend/vitest.config.ts:1` | 增加 `resolve.alias` 指向 `src` | 保证 `@/` 路径可解析 |
| `project/frontend/src/api/anchor.ts:50` | `fetchAnchors` 改为 `/roots/{root_id}/anchors` + `branch_id` | 对齐后端 anchors 接口 |
| `project/frontend/src/api/entity.ts:4` | world 实体与关系接口改为 `/roots/{root_id}` 路由与 `branch_id` | 对齐后端 entities/relations 接口 |
| `project/frontend/src/api/scene.ts:3` | scene 相关 API 补齐 `branch_id` 参数 | 对齐后端 scenes 接口 |
| `project/frontend/src/api/subplot.ts:19` | `fetchSubplots` 使用 `/roots/{root_id}/subplots` | 对齐后端 subplots 列表接口 |
| `project/frontend/src/stores/snowflake.ts:126` | Step4 写入 `root_id`；Step6 获取 anchors 需 `root_id` | 保证 anchors 请求路径有 root_id |
| `project/frontend/src/views/WorldView.vue:86` | world 视图改为传 `root_id/branch_id` | 适配 API 参数签名 |
| `project/frontend/src/views/EditorView.vue:112` | editor 视图改为传 `branch_id` | 适配 scene 接口参数 |

### 关键实现逻辑
- 数据流向：Snowflake Step4 返回 `root_id` 写入 store；World/Editor 调用 API 时显式传 `root_id/branch_id`。
- 关键步骤：API 路径统一为 `/roots/{root_id}` 风格，场景/锚点/实体相关调用携带 `branch_id`。
- 异常处理策略：未补齐 `root_id` 直接抛错（快速失败），不做回退。
- 与其他模块交互：仅调整调用签名与参数传递，不引入新模块。

## 自测结果（仅 enabled 模式）

### 验收结果汇总

| 序号 | 命令 | 返回码 | 结果摘要 |
|-----|------|-------|---------|
| 1 | `grep -c 'npx playwright test' project/frontend/package.json` | 0 | 输出 1 |
| 2 | `grep -c 'resolve' project/frontend/vitest.config.ts` | 0 | 输出 1 |
| 3 | `cd project/frontend && npm run build` | 0 | 构建成功 |

- 全部验收命令已执行: 是
- 自测结果: PASS
- 覆盖率: 未生成（验收未输出 coverage）

### 测试详情
- 构建通过，未再出现类型错误。

## 总结、反思与展望
- 已完成核心任务：脚本修复、alias 修复、API 路径对齐。
- 原则应用：最小改动完成对齐（KISS/YAGNI），接口调整集中在 API 层与调用点（DRY/SRP）。
- 遇到挑战：构建初次失败（类型推断/可空值），通过显式类型转换与非空断言修复。
- 下一步建议：若后端新增实体更新/删除接口，可替换 `updateEntity/deleteEntity` 为真实端点。

结论：PASS
阻塞：无

【MCP调用简报】
服务: 无
触发: 无
参数: 无
结果: 无
状态: 无