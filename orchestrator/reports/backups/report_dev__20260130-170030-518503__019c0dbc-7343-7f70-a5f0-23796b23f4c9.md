已阅读开发行为规范  
iteration: 12  
self_test: enabled

## 任务理解

工单要求实现的功能：
1. 新增 E2E 测试文件 `tests/integration/test_ten_chapter_e2e.py` 覆盖 Step1→Step6 全流程与 10 章渲染。
2. 断言每章渲染字数 1800-2200，并确保流程快速失败。
3. 运行验收命令确保测试可执行并通过。

## 实现方案

### 设计思路
使用 Memgraph 真实存储，Mock 外部 LLM/Gateway 以保证稳定性；通过依赖注入覆盖 SnowflakeManager 与渲染网关，模拟完整流程并保持断言清晰。

### 改动说明

| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/backend/tests/integration/test_ten_chapter_e2e.py:1` | 新增 E2E 测试与 FakeEngine/FakeGateway | 覆盖 Step1-6、10章渲染、字数校验；使用合法 anchor_type |

### 关键实现逻辑
- 数据流向：Step1→Step2→Step3→Step4（落库）→Step5a→Step5b→Step6→逐章 render。
- 关键算法/处理步骤：FakeEngine 生成 50 场景（满足 SCENE_MIN_COUNT），10 章与 10 anchor；FakeGateway 固定返回 2000 字内容。
- 异常处理策略：每步 assert 状态码与数量，任一步骤失败即终止（快速失败）。
- 与其他模块的交互方式：依赖注入替换 LLM/Gateway，真实 Memgraph 落库验证流程连贯性。

## 自测结果（仅 enabled 模式）

### 验收结果汇总

| 序号 | 命令 | 返回码 | 结果摘要 |
|-----|------|-------|---------|
| 1 | `/home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/integration/test_ten_chapter_e2e.py -v` | 0 | 1 passed, 2 warnings |

- 全部验收命令已执行: 是  
- 自测结果: PASS  
- 覆盖率: 未输出（该命令未生成覆盖率）

### 测试详情
测试通过；FastAPI `on_event` 弃用警告存在但不影响结果。

## 测试问题反馈（如有）
无

结论：PASS  
阻塞：无

【MCP调用简报】  
服务: serena  
触发: 新增集成测试与验收执行  
参数: read_file / create_text_file / replace_regex / execute_shell_command（max_answer_chars=-1）  
结果: 新增 E2E 测试并通过  
状态: 成功