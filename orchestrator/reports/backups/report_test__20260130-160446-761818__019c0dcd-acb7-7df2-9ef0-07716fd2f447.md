已阅读测试行为规范
iteration: 6

## 测试需求分析

工单要求测试的功能点：
1. 审核通过：POST review 返回200并持久化为 approved
2. 审核拒绝：POST review 返回200并持久化为 rejected
3. 无效状态：返回400（手动校验，非422）
4. 章节不存在：返回404
5. 幂等性：重复 approve 仍为 approved

## 测试设计

### 设计思路
复用现有 Memgraph 存储与章节种子流程，覆盖通过/拒绝/无效/不存在/幂等五类场景；保持最小用例集合（KISS/YAGNI），避免额外依赖与冗余逻辑。

### 创建的测试文件
- `project/backend/tests/integration/test_chapter_review_api.py:1` - 章节审核API集成测试用例

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| test_review_chapter_approved | 审核通过 | 功能点1 | 创建章节后发起review approved，断言200与持久化 |
| test_review_chapter_rejected | 审核拒绝 | 功能点2 | 创建章节后发起review rejected，断言200与持久化 |
| test_review_chapter_invalid_status | 无效状态 | 功能点3 | 发送非法status，断言400 |
| test_review_chapter_not_found | 章节不存在 | 功能点4 | 不存在ID，断言404 |
| test_review_chapter_idempotent | 幂等 | 功能点5 | 同一章节重复approve，断言仍为approved |

### 关键测试逻辑
- 测试数据准备：使用 Memgraph 存储种子创建 act/chapter，默认 review_status 为 pending。
- 调用接口：`POST /api/v1/chapters/{chapter_id}/review` 与 `GET /api/v1/chapters/{chapter_id}`。
- 断言条件：成功场景断言响应200与 review_status 更新；无效状态断言400；不存在断言404；幂等性重复调用仍为 approved。
- 设计理由：覆盖状态变更与持久化路径，确保接口语义与幂等性。

## 测试执行

- 命令: `/home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/integration/test_chapter_review_api.py -v`
- 结果: 失败
- 红灯确认: 是（接口未实现导致 404）

### 执行详情
- 4 个用例失败：期望 200/400，但返回 404 Not Found（端点未实现）。
- 1 个用例通过：not_found 场景符合 404。
- 另有 FastAPI `on_event` 弃用警告，不影响结果判定。

## 验收标准

- 命令: `/home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/integration/test_chapter_review_api.py -v`
- 阈值: 用例收集成功且失败原因来自接口未实现（红灯）

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取集成测试结构、创建新测试文件、执行测试验证  
参数: read_file/list_dir/create_text_file/execute_shell_command（均含 max_answer_chars: -1）  
结果: 新增测试文件并完成执行，4 fail 1 pass（404 未实现）  
状态: 成功