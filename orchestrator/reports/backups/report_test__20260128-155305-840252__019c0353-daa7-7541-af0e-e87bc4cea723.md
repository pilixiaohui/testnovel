已阅读测试行为规范
iteration: 6

## 测试需求分析

工单要求测试的功能点：
1. Step1 logline：输入 idea → 调用 step1 API → state.logline 更新。
2. Step2 root：基于 logline 选择 → 调用 step2 API → state.root 更新。
3. Step3 characters：调用 step3 API → state.characters 更新。
4. Step4 scenes：调用 step4 API → state.scenes 更新。
5. Step5 acts/chapters：调用 step5a/step5b API → state.acts 与 state.chapters 更新。
6. Step6 anchors：调用 anchor API → state.anchors 更新。
7. 失败路径：任一步骤 API 失败时不应推进下一步状态（保持前一步状态）。

## 测试设计

### 设计思路
- 在 `test:integration` 指定文件内覆盖 Step1-6 全流程，使用 API mock 形成可控的端到端调用链。
- 通过顺序调用 store actions 验证每一步状态推进与 API 调用参数。
- 通过让 Step3 API 失败，验证失败后状态不前进。

### 创建的测试文件
- `project/frontend/tests/fe_core_views_contract.spec.ts:1` - 新增 Snowflake Step1-6 端到端流程与失败路径的集成测试（保留原视图契约测试）。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| SnowflakeFlow exposes root, list, and primary action | 视图契约 | 兼容性 | 视图节点存在性检查 |
| SimulationConsole exposes console root, log, and controls | 视图契约 | 兼容性 | 视图节点存在性检查 |
| SceneEditor exposes editor root, form, and save action | 视图契约 | 兼容性 | 视图节点存在性检查 |
| WorldManager exposes root, list, and create action | 视图契约 | 兼容性 | 视图节点存在性检查 |
| runs step1-6 end-to-end and updates state | 正常流程 | 功能点1-6 | mock API 返回，依次调用 store actions 并断言 state 更新 |
| does not advance when a step API fails | 失败路径 | 功能点7 | Step3 reject，断言后续 state 仍为空 |

### 关键测试逻辑
- 测试数据准备：构造 logline/root/characters/scenes/acts/chapters/anchors 的 mock 返回值。
- 调用接口/函数：依次调用 `store.fetchStep1` → `fetchStep2` → `fetchStep3` → `fetchStep4` → `fetchStep5` → `fetchStep6`。
- 断言条件：每步 API 调用参数正确、state 对应字段更新；失败时 state 不前进。
- 设计理由：覆盖端到端步骤链路与失败回滚的核心业务行为。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npm run test:integration`
- 结果: 通过
- 红灯确认: 否（测试全部通过）

### 执行详情
- `tests/fe_core_views_contract.spec.ts` 共 6 条用例全部通过。
- 未出现实现缺失导致的红灯，说明当前实现已满足测试断言或测试需进一步增强。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 阈值: 测试可运行且覆盖场景，当前应为红灯（实现前）

结论：FAIL  
阻塞：预期红灯未出现（实现可能已完成或测试断言需要加强）

【MCP调用简报】
服务: serena  
触发: 读取工单、更新集成测试、执行测试  
参数: read_file, create_text_file, execute_shell_command  
结果: 更新 `project/frontend/tests/fe_core_views_contract.spec.ts:1`；`npm run test:integration` 全部通过  
状态: 成功