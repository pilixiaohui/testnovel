已阅读测试行为规范  
iteration: 22

## 测试需求分析

工单要求测试的功能点：
1. 增加后端健康检查逻辑（beforeAll 中检测后端是否可用）
2. 后端不可用时跳过真实接口测试
3. 后端可用时执行真实接口请求测试
4. 等待超时调整为合理值（考虑 600s 配置）

## 测试设计

### 设计思路
- 真实接口模式通过 `E2E_API_MODE=real` 控制；在 `beforeEach` 中统一判断并跳过，保持 KISS。
- 健康检查通过 `/api/v1/health` 请求探测可达性：状态码 < 500 视为可用（包含 404）。
- 健康检查使用短超时（6s）快速失败，真实请求等待使用 600000ms 以匹配前端超时配置。
- 不引入额外依赖，复用 Playwright `request` fixture。

### 创建的测试文件
- `project/frontend/tests/e2e/real-api.spec.ts:1` - 真实接口模式测试与健康检查/跳过策略

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| 真实接口模式下请求可发出 | 真实接口模式 | 功能点2/3/4 | 健康检查通过后访问 `/snowflake` 触发 `/api/v1/snowflake/step1`，等待响应并断言 200 |
| 前端 axios 超时配置为 600000ms | 配置校验 | 功能点4 | 读取 `src/api/index.ts` 源码断言 `timeout: 600000` |

### 关键测试逻辑
- 健康检查：`beforeAll` 调用 `/api/v1/health`（6s 超时），状态码 < 500 视为可用；失败则标记不可用。
- 跳过策略：`beforeEach` 中 `test.skip(!isRealApiMode)` 与 `test.skip(!backendAvailable)`。
- 真实请求：不注册 `page.route`，直接触发真实接口并等待响应（600000ms）。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && E2E_API_MODE=real npx playwright test real-api.spec.ts`
- 结果: 通过（2 个用例被跳过）
- 红灯确认: 否（后端不可用时按需求跳过）

### 执行详情
- `npx playwright test real-api.spec.ts --list` 列出 2 个用例。
- 运行测试时 2 个用例均被跳过（健康检查判定后端不可用）。
- 无语法/导入错误。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test real-api.spec.ts --list`
- 阈值: 列出 2 个测试用例

结论：BLOCKED  
阻塞：后端不可用导致真实接口用例跳过，未能验证红灯（环境问题）

【MCP调用简报】
服务: serena  
触发: 编辑测试文件（健康检查与跳过策略）  
参数: create_text_file(relative_path=project/frontend/tests/e2e/real-api.spec.ts)  
结果: 覆盖并更新测试逻辑  
状态: 成功