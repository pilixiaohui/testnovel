已阅读测试行为规范
iteration: 22

## 测试需求分析

工单要求测试的功能点：
1. SnowflakeFlow：idea→logline→root→角色/场景/幕章/锚点，断言请求链路与 UI 更新
2. SimulationConsole：加载场景→运行回合/场景→日志与收敛指示更新
3. SceneEditor：加载→编辑 summary/outcome→保存→diff/render/dirty 流程
4. WorldManager：实体/关系/锚点/支线加载与 CRUD；关系图谱渲染
5. Settings：配置项保存与提示（实现缺失应红灯）

## 测试设计

### 设计思路
- 使用 Playwright E2E 按路由访问真实页面，`data-test` 选择器驱动 UI 交互。
- 通过 `page.route` mock API，断言请求链路与 UI 状态变化。
- 允许实现缺失导致断言失败，作为红灯验证点。

### 创建的测试文件
- `project/frontend/tests/e2e/core.e2e.spec.ts:1` - 5 个核心流程的 E2E 覆盖，包含 dev server 启动与 API mock。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| SnowflakeFlow 核心流程 | 正常流程 | 功能点1 | 输入 idea，逐步点击触发 step1~6，请求链路与 UI 文案断言 |
| SimulationConsole 核心流程 | 正常流程 | 功能点2 | Start/Step/Scene 触发 API，日志与收敛标记断言 |
| SceneEditor 核心流程 | 正常流程 | 功能点3 | Load→输入/选择→Save→Diff→Render，断言 dirty 与渲染内容 |
| WorldManager 核心流程 | 正常流程 | 功能点4 | Load/CRUD/Relations 调用 API，列表与关系图谱断言 |
| Settings 保存流程 | 缺失路径 | 功能点5 | 断言保存按钮存在与提示（当前缺失即红灯） |

### 关键测试逻辑
- 测试数据准备：对 Snowflake/Simulation/Scene/World 相关 API 进行 `page.route` mock。
- 调用接口/函数：通过 UI 点击触发请求，使用 `page.waitForResponse` 同步等待。
- 断言条件：验证关键 UI 渲染、日志数量、dirty 标记、关系图谱显示。
- 设计理由：覆盖“UI 触发→API→状态/UI”闭环，确保链路可运行且实现缺失可暴露。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npx playwright test`
- 结果: 失败
- 红灯确认: 是（断言失败，表现为实现缺失/未更新 UI）

### 执行详情
- 通过：SnowflakeFlow、SimulationConsole、WorldManager
- 失败：
  - SceneEditor：加载后 `scene-title-input` 仍为空，未更新为返回的 `Opening`
  - Settings：`[data-test="settings-save"]` 不存在
- 失败类型均为断言失败，属于实现缺失/未接入导致的正常红灯

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test`
- 阈值: 测试可运行并覆盖上述场景；实现缺失应触发红灯

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena
触发: 读取工单/代码、调整 E2E 测试文件
参数: read_file/replace_regex（`project/frontend/tests/e2e/core.e2e.spec.ts`）
结果: 完成测试文件修正与执行前准备
状态: 成功