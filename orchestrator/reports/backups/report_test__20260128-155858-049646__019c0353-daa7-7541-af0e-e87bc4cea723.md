已阅读测试行为规范
iteration: 7

## 测试需求分析

工单要求测试的功能点：
1. 通过挂载 SnowflakeFlow，使用 UI 交互触发 Step1-6，验证 API 调用与 store 更新。
2. 未接入时应失败（UI 未触发 action 或数据未渲染时红灯）。
3. Step3 失败路径：API 失败后 UI 与 state 不推进到后续步骤。

## 测试设计

### 设计思路
- 在 `test:integration` 指定的 `fe_core_views_contract.spec.ts` 内新增 UI 触发式集成测试。
- 通过 data-test 选择器驱动输入/按钮交互，断言 API 调用与 store 状态更新。
- 对 Step3 失败场景设置 API reject，验证后续状态保持不变。
- 由于当前 UI 未接入 store/actions，预期产生红灯（断言失败）。

### 创建的测试文件
- `project/frontend/tests/fe_core_views_contract.spec.ts:1` - 增强为包含 SnowflakeFlow UI 触发的 Step1-6 集成测试与失败路径。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| drives step1-6 via UI and updates store | 正常流程 | 功能点1 | UI 触发 Step1-6，断言 API 调用与 store 更新 |
| stops progress when step3 fails | 异常处理 | 功能点3 | Step3 API reject，断言 store 不推进 |

### 关键测试逻辑
- 测试数据准备：logline/root/characters/scenes/acts/chapters/anchors 通过 mock 返回。
- 调用接口/函数：通过 UI 选择器（如 `snowflake-idea-input`、`snowflake-step1-submit` 等）触发各步骤。
- 断言条件：API mock 被调用、store 对应字段更新；Step3 失败时后续字段保持空。
- 设计理由：覆盖 UI→store→API 的端到端链路，确保未接入时产生红灯。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npm run test:integration`
- 结果: 失败
- 红灯确认: 是（断言失败，UI 未接入导致）

### 执行详情
- 失败用例：
  - `drives step1-6 via UI and updates store`：`snowflake-idea-input` 未存在（UI 未接入），断言失败。
  - `stops progress when step3 fails`：同样在 UI 入口缺失处断言失败。
- 其余 4 个视图契约用例通过。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 阈值: 测试可运行且覆盖场景，当前应为红灯（实现前）

结论：PASS  
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取工单、更新集成测试、执行测试  
参数: read_file, create_text_file, execute_shell_command  
结果: 更新 `project/frontend/tests/fe_core_views_contract.spec.ts:1`；`npm run test:integration` 产生红灯  
状态: 成功