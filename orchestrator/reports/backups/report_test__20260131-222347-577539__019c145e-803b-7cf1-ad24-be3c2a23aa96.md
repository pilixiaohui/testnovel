已阅读测试行为规范  
iteration: 20

## 测试需求分析

工单要求测试的功能点：
1. E2E测试支持真实接口模式（不注册page.route mock）
2. 真实接口模式下验证超时配置生效（前端600s超时）
3. 测试可通过环境变量或配置切换mock/real模式

## 测试设计

### 设计思路
- 使用 `E2E_API_MODE=real` 作为真实接口模式开关；非 real 时直接 skip，满足“mock 模式跳过”要求（KISS/YAGNI）。
- 真实接口用例不注册任何 `page.route`，通过页面操作触发真实请求并等待响应，符合“真实接口模式”验证。
- 超时配置用例通过读取 `src/api/index.ts` 静态校验 `timeout: 600000`，避免引入额外依赖（DRY/KISS）。
- 请求等待设置快速失败窗口，避免长时间阻塞（快速失败）。

### 创建的测试文件
- `project/frontend/tests/e2e/real-api.spec.ts` - 真实接口模式与超时配置验证

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| 真实接口模式下请求可发出 | 真实接口模式 | 功能点1 | 打开 `/snowflake`，触发 step1 请求，等待真实响应并断言 200 |
| 前端 axios 超时配置为 600000ms | 配置校验 | 功能点2 | 读取 `src/api/index.ts`，断言 `timeout: 600000` |

### 关键测试逻辑
- 模式切换：`E2E_API_MODE !== 'real'` 时 `test.skip`，确保 mock/real 可切换。
- 真实接口请求：不使用 `page.route`，通过 `data-test` 触发真实请求。
- 响应校验：`page.waitForResponse` 在 15000ms 内等待真实响应并断言 200（快速失败）。
- 超时配置：读取源码并断言 `timeout: 600000` 存在。

## 测试执行

- 命令: `cd project/frontend && E2E_API_MODE=real npx playwright test real-api.spec.ts`
- 结果: 失败
- 红灯确认: 是（真实接口请求未在窗口内返回）

### 执行详情
- 失败用例：`真实接口模式下请求可发出`
- 失败原因：`page.waitForResponse` 超时（15000ms 内未收到 `**/api/v1/snowflake/step1` 响应）
- 通过用例：`前端 axios 超时配置为 600000ms`

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test real-api.spec.ts --list`
- 阈值: 列出 2 个用例

结论：FAIL  
阻塞：真实接口响应超时（`page.waitForResponse` 超时 15000ms）

【MCP调用简报】
服务: serena  
触发: 测试文件检索与创建、读取配置与示例  
参数: list_dir/read_file/search_for_pattern/create_text_file/replace_regex (relative_path=project/frontend/...)  
结果: 新增 `project/frontend/tests/e2e/real-api.spec.ts` 并调整快速失败等待  
状态: 成功