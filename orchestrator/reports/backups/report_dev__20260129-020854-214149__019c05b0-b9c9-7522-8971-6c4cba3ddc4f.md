已阅读开发行为规范  
iteration: 3  
self_test: enabled  

## 任务理解

工单要求实现的功能：
1. 修复 Pinia typings 解析失败导致的 `vue-tsc` 报错。
2. 修复 store 类型缺失与隐式 any 报错（TS2339/TS7006）。
3. 解决 Vite/Vitest 插件类型冲突，保证 `npm run build` 成功。

## 实现方案

### 设计思路
优先用最小改动恢复类型解析链路：通过 tsconfig 明确 moduleResolution 与 types 解决 Pinia 导出兼容问题；将 Vitest 配置拆分到独立文件以避免 Vite 插件类型冲突；对 store/getters 与部分回调参数补全显式类型，消除严格模式下的隐式 any 与不安全断言问题。保持 KISS/YAGNI，不引入额外抽象。

### 改动说明

| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/frontend/tsconfig.app.json:4` | 增加 `types` 中的 `pinia`，并将 `moduleResolution` 调整为 `node` | 避免 Pinia 2.0.0 exports 未暴露 types 导致解析失败 |
| `project/frontend/vite.config.ts:1` | 改用 `vite` 的 `defineConfig` 并移除 `test` 配置 | 让 Vite 配置回归纯 Vite 类型，避免 Vitest 插件类型冲突 |
| `project/frontend/vitest.config.ts:1` | 新增 Vitest 配置文件 | 独立承载 `test`/coverage 配置，隔离类型系统 |
| `project/frontend/tsconfig.node.json:25` | 将 `vitest.config.ts` 加入 include | 保障新配置文件在 Node TS 构建中受管 |
| `project/frontend/src/stores/snowflake.ts:92` | getters 参数显式标注 `SnowflakeState` | 修复隐式 any，确保严格模式通过 |
| `project/frontend/src/stores/editor.ts:25` | getters 参数显式标注 `EditorStoreState` | 修复隐式 any |
| `project/frontend/src/stores/simulation.ts:17` | getters 参数显式标注 `SimulationState` 并修正 `runRound/runScene` 断言 | 解决 TS7006/TS2352 |
| `project/frontend/src/stores/world.ts:24` | getters 参数显式标注 `WorldStoreState` | 修复隐式 any |
| `project/frontend/src/views/SimulationConsole.vue:81` | `.then` 回调补充类型 | 修复 TS7006 |
| `project/frontend/src/views/WorldManager.vue:143` | 调整关系数据断言为 `unknown as` | 修复 AxiosResponse 到数组的类型不匹配 |

### 关键实现逻辑
- 数据流向：构建阶段由 `tsconfig.app.json` 控制前端类型解析，Vite/Vitest 配置拆分后分别由对应配置文件处理。
- 关键处理步骤：修正 moduleResolution/types → 拆分 Vitest 配置 → 补全 store/getters 与回调类型 → 消除类型断言冲突。
- 异常处理策略：保持快速失败，不新增兜底逻辑。
- 与其他模块交互方式：仅调整配置和类型，不改变业务逻辑与 API 行为。

## 自测结果（仅 enabled 模式）

### 验收结果汇总

| 序号 | 命令 | 返回码 | 结果摘要 |
|-----|------|-------|---------|
| 1 | `cd project/frontend && npm run build` | 0 | `vite build` 成功，产物生成 |
| 2 | `ls project/frontend/dist/` | 0 | `assets`, `index.html`, `vite.svg` |

- 全部验收命令已执行: 是  
- 自测结果: PASS  

### 测试详情
`vue-tsc -b` 与 `vite build` 均成功，无 TypeScript 报错。

结论：PASS  
阻塞：无  

【MCP调用简报】
服务: serena  
触发: 读取配置/源码并修改以修复构建错误  
参数: read_file/create_text_file/replace(相关配置与 store/view 文件)  
结果: 类型解析与构建问题修复  
状态: 成功