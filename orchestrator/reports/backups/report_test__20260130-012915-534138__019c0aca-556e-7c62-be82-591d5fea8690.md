已阅读测试行为规范
iteration: 3

## 测试需求分析

工单要求测试的功能点：
1. ToponeGateway必须具有generate_act_list方法
2. ToponeGateway必须具有generate_chapter_list方法
3. ToponeGateway必须具有generate_story_anchors方法
4. LLMEngine必须具有上述三个方法
5. LocalStoryEngine必须具有上述三个方法（或明确抛出NotImplementedError）

## 测试设计

### 设计思路
采用契约测试，仅校验方法存在性与异步定义（async），不触及实现逻辑，确保KISS与YAGNI；这样能在实现缺失时快速红灯。

### 创建的测试文件
- `project/backend/tests/unit/test_snowflake_engine_contract.py` - Snowflake引擎Step5a/Step5b/锚点接口契约测试

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| test_topone_gateway_has_generate_act_list | 方法存在性 | 功能点1 | ToponeGateway需有generate_act_list且为async |
| test_topone_gateway_has_generate_chapter_list | 方法存在性 | 功能点2 | ToponeGateway需有generate_chapter_list且为async |
| test_topone_gateway_has_generate_story_anchors | 方法存在性 | 功能点3 | ToponeGateway需有generate_story_anchors且为async |
| test_llm_engine_has_step5_methods | 方法存在性 | 功能点4 | LLMEngine需具备三方法且为async |
| test_local_story_engine_has_step5_methods | 方法存在性 | 功能点5 | LocalStoryEngine需具备三方法且为async（允许后续实现为NotImplementedError） |

### 关键测试逻辑
- 测试数据如何准备：无需输入数据，仅通过模块加载与反射检查
- 调用什么接口/函数：`load_module` + `require_class` + `require_async_method`
- 断言什么条件：类存在、方法存在且为async
- 为什么这样设计能验证需求：契约层面直接验证方法是否具备，是接口一致性的最小验证面

## 测试执行

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/unit/test_snowflake_engine_contract.py -v`
- 结果: 失败
- 红灯确认: 是（因实现缺失导致断言失败）

### 执行详情
- 失败用例：
  - `test_topone_gateway_has_generate_act_list`：ToponeGateway.generate_act_list 缺失
  - `test_topone_gateway_has_generate_chapter_list`：ToponeGateway.generate_chapter_list 缺失
  - `test_topone_gateway_has_generate_story_anchors`：ToponeGateway.generate_story_anchors 缺失
  - `test_local_story_engine_has_step5_methods`：LocalStoryEngine.generate_act_list 缺失
- 通过用例：`test_llm_engine_has_step5_methods`

## 验收标准

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest project/backend/tests/unit/test_snowflake_engine_contract.py -v`
- 阈值: 测试可运行且因方法缺失产生红灯

结论：PASS  
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取被测代码与创建契约测试文件  
参数: read_file/list_dir/search_for_pattern/create_text_file  
结果: 新增测试文件 `project/backend/tests/unit/test_snowflake_engine_contract.py`，完成契约测试用例  
状态: 成功