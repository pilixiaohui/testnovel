已阅读开发行为规范
iteration: 8
self_test: enabled

## 任务理解

工单要求实现的功能：
1. 在 SnowflakeFlow 中接入 Step1-6 的 UI → store → API 链路，并提供 data-test 入口。
2. 严格按 logline→root→characters→scenes→acts/chapters→anchors 的顺序驱动。
3. Step3 失败时停止后续步骤推进（快速失败）。
4. 集成测试转绿。

## 实现方案

### 设计思路
用最小 UI 结构承载 Step1-6 入口与结果展示，所有操作仅触发 store actions，保持单向数据流（UI→store→API→UI）。通过缓存 Step4 Promise 确保 Step5 使用正确 root_id，避免异步顺序导致的状态错位；Step3 失败时直接中止后续处理，不做兜底。

### 改动说明

| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/frontend/src/views/SnowflakeFlow.vue:1` | 重建 SnowflakeFlow UI，增加 step1-6 输入/按钮与 data-test 入口，接入 store 并同步渲染状态 | 用最小交互满足集成测试，保证 UI 与 store 状态一致 |
| `project/frontend/src/stores/snowflake.ts:147` | `fetchStep4` 返回完整 Step4Result | 便于 UI 获取 root_id，确保 Step5 payload 正确 |

### 关键实现逻辑
- 数据流向：UI 触发 `store.fetchStep1~6` → store 更新 `steps` → UI 读取 store 渲染结果。
- 关键处理步骤：
  - Step1 设置 logline 并选中首条。
  - Step2 使用选中 logline 获取 root。
  - Step3 获取角色列表；失败时中止，不推进后续步骤。
  - Step4 返回完整结果并缓存 Promise，写入 scenes 与 root_id。
  - Step5 在执行前等待 Step4 Promise，确保 root_id 就绪。
  - Step6 拉取 anchors 更新状态。
- 异常处理策略：仅 Step3 捕获失败并停止推进，其他步骤保持快速失败。
- 与其他模块交互方式：SnowflakeFlow 只依赖 Pinia store 与 API；store 负责 Step API 调用与状态写入。

## 自测结果（仅 enabled 模式）

- 验收命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 返回码: 0
- 测试通过数: 6 passed, 0 failed
- coverage: N/A（test:integration 不产出覆盖率）
- 自测结果: PASS

### 测试详情
- `tests/fe_core_views_contract.spec.ts` 全部通过。

## 测试问题反馈（如有）

无

## 总结与展望
- 已完成 Snowflake Step1-6 UI→store→API 接入，集成测试转绿。
- KISS/YAGNI：仅保留测试所需 UI 与数据流；DRY：复用 store 作为单一数据源；SOLID：Step 处理各自单一职责。
- 遇到挑战：Step4/Step5 的异步顺序与 root_id 依赖；通过缓存 Step4 Promise 解决。
- 下一步建议：如需覆盖率验收，可运行 `npm run test:coverage` 进行补充验证。

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取任务与代码、修改 SnowflakeFlow/store、执行集成测试  
参数: read_file/replace_regex/execute_shell_command（test:integration）  
结果: 6 passed  
状态: 成功