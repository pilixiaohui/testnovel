已阅读测试行为规范
iteration: 7

## 测试需求分析

工单要求测试的功能点：
1. Chapter模型包含rendered_content字段（字符串类型）
2. Chapter模型包含review_status字段（枚举类型：pending/approved/rejected）
3. review_status默认值为pending
4. Memgraph create_chapter支持这两个字段
5. Memgraph get_chapter返回这两个字段

## 测试设计

### 设计思路
以模型字段断言+默认值/非法值校验覆盖Chapter模型扩展；以schema字段断言确保持久化结构可存储；以MemgraphStorage方法签名和props映射验证创建/持久化支持；以DummyDB模拟get_chapter回填字段。

### 创建的测试文件
- `project/backend/tests/unit/test_chapter_model.py` - Chapter模型字段、默认值、枚举校验，以及Memgraph存储层字段支持性测试

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| test_chapter_model_has_rendered_content_and_review_status | 字段存在性 | 功能点1/2 | 断言Chapter.model_fields包含rendered_content与review_status |
| test_chapter_review_status_default_pending | 默认值 | 功能点3 | 不传review_status时应默认pending |
| test_chapter_review_status_rejects_invalid_value | 枚举校验 | 功能点2 | review_status非法值触发ValidationError |
| test_schema_chapter_fields_include_rendered_content_and_review_status | Schema字段 | 功能点4/5 | 断言存储schema包含rendered_content与review_status |
| test_memgraph_create_chapter_accepts_rendered_content_and_review_status | 创建接口签名 | 功能点4 | 断言create_chapter参数包含rendered_content/review_status |
| test_memgraph_chapter_props_include_rendered_content_and_review_status | 持久化props | 功能点4 | _chapter_props输出应包含新字段 |
| test_memgraph_get_chapter_returns_rendered_content_and_review_status | 读取回填 | 功能点5 | DummyDB返回包含新字段，get_chapter应读到 |

### 关键测试逻辑
- 测试数据准备：构造最小Chapter参数，并补齐rendered_content与review_status。
- 调用接口/函数：Chapter模型直接实例化；schema使用schema_contract_helpers；MemgraphStorage用`__new__`绕过连接，调用签名/props；DummyDB模拟`execute_and_fetch`返回。
- 断言条件：字段存在、默认值为pending、非法review_status触发ValidationError、create_chapter签名包含新字段、props与get_chapter结果包含新字段。
- 设计理由：覆盖模型、schema与存储层三处契约一致性。

## 测试执行

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/unit/test_chapter_model.py -v`
- 结果: 失败
- 红灯确认: 是（实现缺失导致字段/默认值/存储支持不满足）

### 执行详情
- 失败用例：
  - `test_chapter_model_has_rendered_content_and_review_status`：Chapter缺少rendered_content/review_status字段
  - `test_chapter_review_status_default_pending`：review_status不存在导致AttributeError
  - `test_chapter_review_status_rejects_invalid_value`：非法值未触发ValidationError（字段不存在）
  - `test_schema_chapter_fields_include_rendered_content_and_review_status`：schema缺少字段
  - `test_memgraph_create_chapter_accepts_rendered_content_and_review_status`：create_chapter签名缺少参数
  - `test_memgraph_chapter_props_include_rendered_content_and_review_status`：_chapter_props未包含字段
- 通过用例：`test_memgraph_get_chapter_returns_rendered_content_and_review_status`（DummyDB返回包含字段）

## 验收标准

- 命令: `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/unit/test_chapter_model.py -v`
- 阈值: 测试文件存在、可运行，当前因实现未完成产生红灯失败

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena
触发: 读取被测代码与存储实现、编写测试、执行测试
参数: read_file/search_for_pattern/create_text_file/execute_shell_command（均显式 max_answer_chars: -1）
结果: 新增测试文件1个；测试执行1次，红灯6处
状态: 成功