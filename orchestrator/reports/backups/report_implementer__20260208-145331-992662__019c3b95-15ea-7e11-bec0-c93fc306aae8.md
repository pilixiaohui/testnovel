已阅读实现者行为规范
iteration: 3

## Phase 1: 红灯阶段

### 测试设计思路
- 以用户最高优先级问题为主线，先锁定“雪花步骤只显示名称、不显示完整字段/原始数据”的回归点。
- 先写失败用例验证缺口：  
  1) SnowflakeView 中缺少 `one_sentence_summary`、`sequence_index`、`achieved` 的结构化展示；  
  2) Character/Scene/Act/Chapter/Step6 卡片缺少 raw JSON 展示。  
- 通过“视图级 + 组件级”双层测试覆盖，避免只测单层导致回归漏检。

### 创建的测试文件
- `project/frontend/tests/snowflake_full_content_display.spec.ts` - 扩展现有集成测试，补充缺失字段断言（summary/sequence/achieved）。
- `project/frontend/tests/snowflake_cards_full_fields.spec.ts` - 新增卡片/面板测试，验证结构化字段 + raw JSON 展示。

### 测试用例清单
| 用例名称 | 测试场景 | 预期结果 |
|---------|---------|---------|
| SnowflakeView full details | Step3/4/6 完整字段展示 | summary、sequence、achieved 均可见 |
| CharacterCard full fields | 角色卡片渲染 | ambition/conflict/epiphany/voice_dna/one_sentence_summary + raw JSON |
| SceneCard full fields | 场景卡片渲染 | title/sequence/expected_outcome/conflict_type + raw JSON |
| Act/Chapter full fields | 幕章卡片渲染 | act(title/purpose/tone)、chapter(title/focus/pov_character_id) + raw JSON |
| Step6Panel full fields | 锚点卡片渲染 | required_conditions、achieved + raw JSON |
| Step3/4/5 panel wrappers | 面板透传卡片展示 | 面板中可见各卡片 raw 区域，确保非“名字列表” |

### 红灯确认
- 命令: `npx vitest run tests/snowflake_full_content_display.spec.ts tests/snowflake_cards_full_fields.spec.ts`
- 结果: 失败（预期）
- 失败原因: 新增断言对应的选择器/字段在实现中不存在（例如 `snowflake-character-summary`、`snowflake-scene-sequence-index`、`snowflake-anchor-achieved`，以及各卡片 raw 区域）。

## Phase 2: 绿灯阶段

### 实现方案
- **KISS**：只改展示层，不改后端接口，不引入新依赖。
- **DRY**：Step3/4/5 继续复用卡片组件，补齐卡片本体的完整字段与 raw 展示，避免在多个页面重复拼装字段。
- **YAGNI**：不引入复杂展示状态机，仅补齐当前验收明确要求的字段与测试覆盖。
- **快速失败**：保持现有严格校验风格，不增加兜底吞错逻辑。

### 改动说明
| 文件 | 修改内容 | 实现逻辑 |
|-----|---------|---------|
| `project/frontend/src/components/snowflake/CharacterCard.vue:11` | 新增结构化字段与 raw 区域 | 展示 `name/ambition/conflict/epiphany/voice_dna/one_sentence_summary` + `JSON.stringify` |
| `project/frontend/src/components/snowflake/SceneCard.vue:5` | 补齐场景关键字段与 raw 区域 | 展示 `title/sequence_index/expected_outcome/conflict_type`（含 actual/parent）+ raw |
| `project/frontend/src/components/snowflake/ActCard.vue:8` | 新增 raw 区域 | 展示 `title/purpose/tone` + raw |
| `project/frontend/src/components/snowflake/ChapterCard.vue:8` | 新增 raw 区域 | 展示 `title/focus/pov_character_id` + raw |
| `project/frontend/src/components/snowflake/Step6Panel.vue:8` | 新增 achieved/required_conditions/raw 展示 | 锚点卡片展示 `anchor_type/description/constraint_type/required_conditions/achieved` |
| `project/frontend/src/views/SnowflakeView.vue:141` | Step3 增加 summary 字段展示 | 补齐 `one_sentence_summary` 可视化 |
| `project/frontend/src/views/SnowflakeView.vue:172` | Step4 增加 sequence 字段展示 | 结构化显示 `sequence_index` |
| `project/frontend/src/views/SnowflakeView.vue:249` | Step6 增加 achieved 展示 | 增加 `snowflake-anchor-achieved` 显示 |
| `project/frontend/src/views/SnowflakeView.vue:313` | 新增 `readAnchorAchieved` | 将 anchor 的 achieved 统一解析为布尔展示 |
| `project/frontend/tests/snowflake_full_content_display.spec.ts:162` | 扩展集成断言 | 验证 summary/sequence/achieved 及 raw 字段 |
| `project/frontend/tests/snowflake_cards_full_fields.spec.ts:10` | 新增组件级测试 | 验证 Step3/4/5/6 相关卡片与面板完整展示 |

### 绿灯确认
- 命令: `npx vitest run tests/snowflake_full_content_display.spec.ts tests/snowflake_cards_full_fields.spec.ts`
- 结果: 6 passed
- 覆盖率: 在全量覆盖率中已计入（见下）

## 自测结果汇总

| 验收命令 | 返回码 | 结果 |
|---------|-------|------|
| `npx vitest run tests/snowflake_full_content_display.spec.ts tests/snowflake_cards_full_fields.spec.ts` | 0 | 2 files / 6 tests passed |
| `npm --prefix project/frontend run test:unit` | 0 | 50 files / 280 tests passed |
| `npm --prefix project/frontend run test:coverage` | 0 | All files: Stmts 89.4%, Branch 81.25%, Funcs 90.08%, Lines 89.52% |
| Playwright MCP：首页创建项目→雪花页验证→设置页验证→推演触发 | N/A | 项目创建成功、Step4 显示 Sequence、Settings 显示真实 LLM 配置、推演可触发 |
| Playwright MCP 控制台检查 `browser_console_messages(level=\"error\")` | N/A | 0 error |
| Playwright MCP 网络检查 `browser_network_requests(includeStatic=false)` | N/A | 关键请求 200（`POST /api/v1/roots`、`GET /api/v1/settings/llm`、`POST /api/v1/simulation/scene`） |
| 反作弊扫描（本轮改动文件） | 0 | 未命中硬编码 ID/URL/TODO 等模式 |

自测结果: PASS

## 职责边界说明

### IMPLEMENTER 测试职责

| 测试类型 | 工具 | 目的 |
|---------|------|------|
| 单元测试 | Bash (`pytest`) | 验证函数逻辑 |
| 前端单元测试 | Bash (`npm run test:unit`) | 验证组件逻辑 |
| E2E 脚本测试 | Bash (`npx playwright test`) | 验证页面流程（Mock 后端） |
| **前端功能自测** | **Playwright MCP** | **验证真实浏览器中的 UI 和交互** |

### Playwright MCP 自测 vs 验证器测试

| 维度 | IMPLEMENTER 自测 | 验证器测试 |
|------|-----------------|-----------|
| 工具 | Playwright MCP | Playwright MCP |
| 目的 | 开发调试、快速反馈 | 独立验证、质量把关 |
| 时机 | 开发过程中随时使用 | 代码提交后 |
| 标准 | 功能基本可用 | 严格验收标准 |
| 网络验证 | 可选 | **必须**验证 API 请求 |

**关键区别**：
- 你的自测是为了**快速发现和修复问题**
- 验证器测试是为了**独立验证质量**，会检测 mock 数据等作弊行为
- 你应该在自测通过后再提交，减少验证器返工

### 真实环境验证（验证器职责）

真实浏览器验证由后续验证器（TEST_RUNNER、EDGE_CASE_TESTER、FINISH_REVIEW）执行。

验证器会执行更严格的检查：
- **网络请求验证**：确保 API 真正被调用，而非 mock 数据
- 前后端集成问题
- 真实数据格式问题
- 边界条件处理问题

你只需确保：
- ✅ 前端服务可正常启动
- ✅ 后端 API 可正常响应
- ✅ 代码无明显的运行时错误
- ✅ 命令行测试全部通过
- ✅ Playwright MCP 自测基本功能正常

## 验证信息

### 测试命令
```yaml
commands:
  - cmd: "npx vitest run tests/snowflake_full_content_display.spec.ts tests/snowflake_cards_full_fields.spec.ts"
    cwd: "/home/zxh/ainovel_v3/project/frontend"
    type: unit
  - cmd: "npm --prefix project/frontend run test:unit"
    cwd: "/home/zxh/ainovel_v3"
    type: unit
  - cmd: "npm --prefix project/frontend run test:coverage"
    cwd: "/home/zxh/ainovel_v3"
    type: unit
```

### 修改文件
```yaml
files:
  - path: "project/frontend/src/components/snowflake/CharacterCard.vue"
    type: implementation
  - path: "project/frontend/src/components/snowflake/SceneCard.vue"
    type: implementation
  - path: "project/frontend/src/components/snowflake/ActCard.vue"
    type: implementation
  - path: "project/frontend/src/components/snowflake/ChapterCard.vue"
    type: implementation
  - path: "project/frontend/src/components/snowflake/Step6Panel.vue"
    type: implementation
  - path: "project/frontend/src/views/SnowflakeView.vue"
    type: implementation
  - path: "project/frontend/tests/snowflake_full_content_display.spec.ts"
    type: test
  - path: "project/frontend/tests/snowflake_cards_full_fields.spec.ts"
    type: test
```

### API 签名
```yaml
signatures:
  - name: "readAnchorAchieved"
    file: "project/frontend/src/views/SnowflakeView.vue"
    params: ["anchor"]
```

结论：PASS
阻塞：无

【MCP调用简报】
服务: serena  
触发: 代码调研、定位与编辑（Step3/4/5/6 卡片展示、SnowflakeView 字段补齐、测试新增）  
参数: `read_file/search_for_pattern/replace_regex/create_text_file`，范围限定 `project/frontend/src` 与 `project/frontend/tests`  
结果: 完成 8 个文件改动，补齐完整字段展示与 raw JSON，新增并通过对应测试  
状态: 成功

【MCP调用简报】
服务: playwright  
触发: 前端真实浏览器自测（项目创建、雪花页字段展示、设置页配置读取、推演触发）  
参数: `browser_navigate/click/type/select_option/console_messages/network_requests/close`，目标 `http://127.0.0.1:5185`  
结果: 控制台 error=0；关键请求 200（`POST /api/v1/roots`、`GET /api/v1/settings/llm`、`POST /api/v1/simulation/scene`）；功能链路可用  
状态: 成功