已阅读测试行为规范
iteration: 10

## 测试需求分析

工单要求测试的功能点：
1. 加载场景/会话：UI 触发加载后，调用 simulation API，state 与日志面板更新。
2. 运行回合/场景：点击运行按钮触发 runRound/runScene，日志追加，状态变化可见。
3. 收敛状态：当 API 返回收敛标记时，UI 收敛指示更新。
4. 失败路径：API 失败时不应推进状态（快速失败）。

## 测试设计

### 设计思路
- 在 `test:integration` 目标文件内新增 SimulationConsole 的 UI 集成测试。
- 使用现有按钮触发（Start/Step）模拟 UI 交互，断言 API 调用与 store 状态更新。
- 通过 API reject 覆盖快速失败路径，确保状态不推进。
- 预期当前未接入时出现红灯（API 未被调用/状态未更新）。

### 创建的测试文件
- `project/frontend/tests/fe_core_views_contract.spec.ts:1` - 新增 SimulationConsole 集成测试（保留 Snowflake 集成与视图契约测试）。

### 测试用例清单

| 用例名称 | 测试场景 | 对应功能点 | 测试逻辑说明 |
|---------|---------|-----------|-------------|
| loads simulations via UI and updates state/log panel | 正常流程 | 功能点1 | 点击 Start → 期望调用 fetchSimulations、状态变为 running、日志数量匹配 |
| runs round/scene via UI and shows convergence indicator | 正常流程 | 功能点2/3 | 点击 Step → 期望调用 runRound、状态更新、出现收敛指示 |
| does not advance when load API fails | 异常处理 | 功能点4 | fetchSimulations reject 后状态保持 idle |

### 关键测试逻辑
- 测试数据准备：构造 mock 的 simulation config 数组作为 fetchSimulations 返回值。
- 调用接口/函数：通过 `[data-test="simulation-start"]` 与 “Step”按钮触发 UI 操作。
- 断言条件：API mock 被调用、store.status 变化、收敛指示存在、失败时状态不推进。
- 设计理由：覆盖 UI→API→store 的核心链路，并显式验证未接入时红灯。

## 测试执行

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 npm run test:integration`
- 结果: 失败
- 红灯确认: 是（断言失败，UI 未接入导致 API 未调用/状态未更新）

### 执行详情
- 失败用例：
  - `loads simulations via UI and updates state/log panel`：`fetchSimulations` 未被调用。
  - `runs round/scene via UI and shows convergence indicator`：`runRound` 未被调用。
  - `does not advance when load API fails`：`fetchSimulations` 未被调用。
- 失败原因：SimulationConsole 目前未接入 store/API，UI 交互未触发调用链路。

## 验收标准

- 命令: `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`
- 阈值: 测试可运行且覆盖上述场景，当前应为红灯（实现前）

结论：PASS  
阻塞：无

【MCP调用简报】
服务: serena  
触发: 读取工单/被测代码、更新集成测试、执行测试  
参数: read_file, create_text_file, execute_shell_command  
结果: 更新 `project/frontend/tests/fe_core_views_contract.spec.ts:1`；`npm run test:integration` 红灯确认  
状态: 成功