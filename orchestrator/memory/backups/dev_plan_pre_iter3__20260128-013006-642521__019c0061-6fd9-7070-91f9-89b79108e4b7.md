# Dev Plan (Snapshot)

> 本文件由 MAIN 维护（可覆盖编辑）。它是当前计划与进度的快照；事实证据以 `orchestrator/reports/report_review.md` 与 `orchestrator/memory/project_history.md` 为准。

## 约束（强制）
- 任务总数必须保持在几十条以内（少而硬）
- 每个任务块必须包含：`status / acceptance / evidence`
- status 只允许：TODO / DOING / BLOCKED / DONE / VERIFIED
- 可选字段：`verification_status: <PENDING_DEV_VALIDATION|DEV_VALIDATED|TEST_PASSED|VERIFIED|REVIEW_REJECTED>` 用于验证闭环跟踪
- 只有 **REVIEW 的证据** 才能把 DONE -> VERIFIED（evidence 必须引用 Iteration 与验证方式）

---

## Milestone M0: 引导与黑板契约

### M0-T1: 建立 dev_plan 状态机
- status: DONE
- acceptance:
- `orchestrator/memory/dev_plan.md` 存在并遵循固定字段
- 每轮更新在 `orchestrator/memory/project_history.md` 留痕（说明改了什么/为什么）
- evidence: Iteration 2（dev_plan 更新 + history_append）

### M0-T2: 审阅代理输出可核实证据
- status: BLOCKED
- acceptance:
- `orchestrator/reports/report_review.md` 包含可复现的命令与关键输出摘要
  - 进度核实：逐条对照 dev_plan 的任务给出 PASS/FAIL 与证据
- evidence: Iteration 1（REVIEW 报告缺少验收命令）

### M0-T3: 补齐验收命令与测试策略
- status: TODO
- acceptance:
- 命令: `test -f orchestrator/workspace/test_plan.md` 阈值: 退出码=0
- evidence:

## Milestone M1: 前端核心视图落地

### M1-T1: SnowflakeFlow 6 步流程与面板
- status: TODO
- acceptance:
- 命令: `rg -n 'snowflake-step-1' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-2' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-3' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-4' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-5' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-6' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- 命令: `rg -n 'snowflake-step-panel' project/frontend/src/views/SnowflakeFlow.vue` 阈值: 退出码=0
- evidence:

### M1-T2: 推演控制台 3 栏布局与联动
- status: TODO
- acceptance:
- 命令: `rg -n 'sim-panel-left' project/frontend/src/views/SimulationConsole.vue` 阈值: 退出码=0
- 命令: `rg -n 'sim-panel-center' project/frontend/src/views/SimulationConsole.vue` 阈值: 退出码=0
- 命令: `rg -n 'sim-panel-right' project/frontend/src/views/SimulationConsole.vue` 阈值: 退出码=0
- 命令: `rg -n 'sim-log-panel' project/frontend/src/views/SimulationConsole.vue` 阈值: 退出码=0
- 命令: `rg -n 'sim-control-panel' project/frontend/src/views/SimulationConsole.vue` 阈值: 退出码=0
- evidence:

### M1-T3: 场景编辑器场景树/标签页/上下文面板
- status: TODO
- acceptance:
- 命令: `rg -n 'scene-tree' project/frontend/src/views/SceneEditor.vue` 阈值: 退出码=0
- 命令: `rg -n 'scene-tabs' project/frontend/src/views/SceneEditor.vue` 阈值: 退出码=0
- 命令: `rg -n 'scene-context-panel' project/frontend/src/views/SceneEditor.vue` 阈值: 退出码=0
- evidence:

### M1-T4: 世界观页实体/关系/锚点/支线标签页
- status: TODO
- acceptance:
- 命令: `rg -n 'world-tab-entities' project/frontend/src/views/WorldManager.vue` 阈值: 退出码=0
- 命令: `rg -n 'world-tab-relations' project/frontend/src/views/WorldManager.vue` 阈值: 退出码=0
- 命令: `rg -n 'world-tab-anchors' project/frontend/src/views/WorldManager.vue` 阈值: 退出码=0
- 命令: `rg -n 'world-tab-subplots' project/frontend/src/views/WorldManager.vue` 阈值: 退出码=0
- evidence:

## Milestone M2: 前端数据层对齐

### M2-T1: 统一 API Client 超时与拦截器
- status: TODO
- acceptance:
- 命令: `rg -n 'timeout' project/frontend/src/api/index.ts` 阈值: 退出码=0
- 命令: `rg -n 'interceptors' project/frontend/src/api/index.ts` 阈值: 退出码=0
- evidence:

### M2-T2: Snowflake API 覆盖 step1-step6
- status: TODO
- acceptance:
- 命令: `rg -n 'step1' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'step2' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'step3' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'step4' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'step5' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'step6' project/frontend/src/api/snowflake.ts` 阈值: 退出码=0
- evidence:

### M2-T3: Snowflake 数据契约与 Store 结构对齐
- status: TODO
- acceptance:
- 命令: `rg -n 'steps' project/frontend/src/types/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'current_step' project/frontend/src/types/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'steps' project/frontend/src/stores/snowflake.ts` 阈值: 退出码=0
- 命令: `rg -n 'current_step' project/frontend/src/stores/snowflake.ts` 阈值: 退出码=0
- evidence:

## Milestone M3: 后端接口与模型对齐

### M3-T1: 补齐 subplots 列表接口
- status: TODO
- acceptance:
- 命令: `rg -n '/api/v1/roots/{root_id}/subplots' project/backend/app/main.py` 阈值: 退出码=0
- evidence:

### M3-T2: dirty_scenes 返回 SceneView[]
- status: TODO
- acceptance:
- 命令: `rg -n 'dirty_scenes' project/backend/app/main.py` 阈值: 退出码=0
- 命令: `rg -n 'SceneView' project/backend/app/main.py` 阈值: 退出码=0
- evidence:

### M3-T3: 结构子图关系类补齐
- status: TODO
- acceptance:
- 命令: `rg -n 'HEAD' project/backend/app/storage/schema.py` 阈值: 退出码=0
- 命令: `rg -n 'PARENT' project/backend/app/storage/schema.py` 阈值: 退出码=0
- 命令: `rg -n 'INCLUDES' project/backend/app/storage/schema.py` 阈值: 退出码=0
- 命令: `rg -n 'OF_ORIGIN' project/backend/app/storage/schema.py` 阈值: 退出码=0
- evidence:

### M3-T4: 递归反馈检测补齐 divergence/repetition
- status: TODO
- acceptance:
- 命令: `rg -n 'divergence' project/backend/app/services/feedback_detector.py` 阈值: 退出码=0
- 命令: `rg -n 'repetition' project/backend/app/services/feedback_detector.py` 阈值: 退出码=0
- evidence:

## Milestone M4: 依赖与结构约束校准

### M4-T1: 移除 google-generativeai 依赖
- status: TODO
- acceptance:
- 命令: `rg -n 'google-generativeai' project/backend/pyproject.toml` 阈值: 退出码=1
- evidence:

### M4-T2: 输出目录结构对齐决策文档
- status: TODO
- acceptance:
- 命令: `test -f orchestrator/workspace/structure_alignment.md` 阈值: 退出码=0
- evidence:

### M4-T3: 应用目录结构对齐（Topone/Storage Port）
- status: TODO
- acceptance:
- 命令: `rg -n 'Topone' project/backend/app/main.py` 阈值: 退出码=0
- 命令: `rg -n 'Storage' project/backend/app/main.py` 阈值: 退出码=0
- evidence:
