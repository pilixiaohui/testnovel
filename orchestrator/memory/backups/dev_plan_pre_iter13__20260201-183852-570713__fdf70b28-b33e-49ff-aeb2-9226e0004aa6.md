# Dev Plan (Snapshot)

> 本文件由 MAIN 维护。基于用户决策opt2与并行审阅结论制定。

## 约束（强制）
- 任务总数保持在几十条以内
- 每个任务块必须包含：status / acceptance / evidence
- status: TODO / DOING / BLOCKED / DONE / VERIFIED
- 只有 REVIEW 证据才能 DONE -> VERIFIED

---

## Milestone M0: 文档修正与测试基线

### M0-T1: 修正文档统计口径
- status: TODO
- acceptance:
  - `doc/frontend_issues_analysis.md:738-740` 统计表修正为 致命4/高12/中20/低4
- evidence:

### M0-T2: 修复前端测试基线
- status: TODO
- acceptance:
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage` 全部通过
  - 修复 EditorView 测试的 router 注入问题
  - 修复 snowflake store 测试的 anchorApi mock 问题
- evidence:

---

## Milestone M1: 致命问题（问题1/2/5/13）

### M1-T1: 后端新增 GET /roots 项目列表端点
- status: DONE
- acceptance:
  - `cd /home/zxh/ainovel_v3/project/backend && pytest tests/integration/test_roots_list_api.py -v` 通过
  - 端点返回 root_id/name/created_at/updated_at
  - 支持 limit/offset 分页
- evidence: Iteration 4 DEV自测PASS，3 passed

### M1-T2: 前端 project store 重写
- status: DONE
- acceptance:
  - `project/frontend/src/stores/project.ts` 包含 loadProject/saveProject/listProjects actions
  - 移除所有 View 内 createPinia/setActivePinia 逻辑
  - root_id/branch_id 作为单一事实源
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test -- tests/project_store.spec.ts` 通过
- evidence: Iteration 6 DEV自测PASS，4 passed

### M1-T3: 项目持久化与恢复（问题1/2）
- status: DONE
- acceptance:
  - 刷新页面后项目状态可恢复
  - HomeView 显示项目列表（调用 GET /roots）
  - 至少1条E2E用例验证刷新恢复
- evidence: Iteration 8 DEV自测PASS，3 passed

### M1-T4: 雪花流程数据保存（问题5）
- status: DONE
- acceptance:
  - 每步完成后调用后端保存API
  - 刷新后可基于 root_id 重建雪花状态
  - 至少1条E2E用例验证
- evidence: Iteration 10 DEV自测PASS，3 passed

### M1-T5: 推演场景上下文加载（问题13）
- status: DOING
- acceptance:
  - SimulationView 加载真实 scene_context 和 agents
  - runRound payload 非空
  - 移除硬编码 sceneId='scene-1'
  - 至少1条E2E用例验证 payload 内容
- evidence:

### M1 验收标准
- `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage` 覆盖率 ≥ 80%
- `cd /home/zxh/ainovel_v3/project/backend && pytest` 全部通过
- 致命问题4条各有至少1条E2E用例

---

## Milestone M2: 高优先级问题（问题3/4/6-7/12/14-15/18-19/24/30-31）
- status: TODO
- 详细任务待M1完成后展开

## Milestone M3: 中低优先级问题
- status: TODO
- 详细任务待M2完成后展开
