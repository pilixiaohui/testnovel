# Dev Plan (Snapshot)

> 本文件由 MAIN 维护（可覆盖编辑）。它是「当前计划与进度」的快照；事实证据以 `orchestrator/reports/report_review.md` 与 `orchestrator/memory/project_history.md` 为准。

## 约束（强制）
- 任务总数必须保持在「几十条」以内（少而硬）
- 每个任务块必须包含：`status / acceptance / evidence`
- status 只允许：TODO / DOING / BLOCKED / DONE / VERIFIED
- 可选字段：`verification_status: <PENDING_DEV_VALIDATION|DEV_VALIDATED|TEST_PASSED|VERIFIED|REVIEW_REJECTED>` 用于验证闭环跟踪
- 只有 **REVIEW 的证据** 才能把 DONE -> VERIFIED（evidence 必须引用 Iteration 与验证方式）

---

## Milestone M0: 引导与黑板契约

### M0-T1: 建立 dev_plan 状态机
- status: VERIFIED
- acceptance:
- `test -f orchestrator/memory/dev_plan.md`（阈值：退出码=0）
- `test -f orchestrator/memory/project_history.md`（阈值：退出码=0）
- evidence: Iteration 1 REVIEW report 产出 dev_plan 任务拆分建议（验证黑板流程已运行）

### M0-T2: 审阅代理输出可核实证据
- status: VERIFIED
- acceptance:
- `rg -c "验收命令" orchestrator/reports/report_review.md`（阈值：>=1）
- `rg -c "测试结果" orchestrator/reports/report_review.md`（阈值：>=1）
- evidence: Iteration 1 REVIEW report 记录可复现命令与关键输出（pytest 4 passed）

---

## Milestone M1: 前后端契约对齐与核心流程落地

### M1-T1: FE-API/Types/Store 对齐 (P0)
- status: VERIFIED
- acceptance:
- `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit`（阈值：>=1 passed）
- `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage`（阈值：覆盖率 >=80%）
- evidence: Iteration 14 REVIEW report（test:unit/test:coverage PASS）

### M1-T2: FE 核心页面与组件最小可用 (P0)
- status: VERIFIED
- acceptance:
- `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration`（阈值：>=1 passed）
- `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage`（阈值：覆盖率 >=80%）
- evidence: Iteration 14 REVIEW report（test:integration/test:coverage PASS）

### M1-T3: BE 数据契约与反馈端点对齐 (P0)
- status: VERIFIED
- acceptance:
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q tests/unit/test_models_bdi.py`（阈值：>=4 passed）
- evidence: Iteration 12 REVIEW report（tests/unit/test_models_bdi.py PASS）

### M1-T4: BE 推演主流程补齐（收敛/补路/锚点驱动）(P0)
- status: VERIFIED
- acceptance:
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q tests/integration/test_simulation_flow.py`（阈值：>=1 passed）
- evidence: Iteration 12 REVIEW report（tests/integration/test_simulation_flow.py PASS）

### M1-T5: FE 路由/构建/依赖与代理对齐 (P1)
- status: VERIFIED
- acceptance:
- `cd /home/zxh/ainovel_v3/project/frontend && npm run build`（阈值：退出码=0）
- evidence: Iteration 12 REVIEW report（npm run build PASS）

### M1-T6: BE 快速失败约束对齐（移除兜底）(P1)
- status: VERIFIED
- acceptance:
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q tests/unit/test_fast_fail.py`（阈值：>=1 passed）
- evidence: Iteration 12 REVIEW report（tests/unit/test_fast_fail.py PASS）

---

## Milestone M2: 迁移与质量门槛（AC-3/AC-4）

### M2-T1: 旧数据迁移与幂等性实现 (P0)
- status: DOING
- acceptance:
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q tests/integration/test_migration.py`（阈值：>=1 passed）
- evidence: Iteration 15 FINISH_REVIEW report（AC-3 缺口）

### M2-T2: 覆盖率与性能基准达标 (P0)
- status: TODO
- acceptance:
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q --cov=app --cov-report=xml --cov-report=term`（阈值：退出码=0）
- `/home/zxh/ainovel_v3/project/backend/.venv/bin/python -c "import xml.etree.ElementTree as ET; r=ET.parse('project/backend/coverage.xml').getroot(); lr=float(r.get('line-rate')); assert lr>=0.80, lr"`（阈值：退出码=0）
- `MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest -q tests/performance/test_benchmark.py`（阈值：退出码=0）
- evidence: Iteration 15 FINISH_REVIEW report（AC-4 缺口）
