# Dev Plan (Snapshot)

> 本文件由 MAIN 维护（可覆盖编辑）。它是"当前计划与进度"的快照；事实证据以 `orchestrator/reports/report_review.md` 与 `orchestrator/memory/project_history.md` 为准。

## 约束（强制）
- 任务总数必须保持在"几十条"以内（少而硬）
- 每个任务块必须包含：`status / acceptance / evidence`
- status 只允许：TODO / DOING / BLOCKED / DONE / VERIFIED
- 只有 **REVIEW 的证据** 才能把 DONE -> VERIFIED（evidence 必须引用 Iteration 与验证方式）

---

## Milestone M0: 引导与黑板契约

### M0-T1: 建立 dev_plan 状态机
- status: DONE
- acceptance:
- `orchestrator/memory/dev_plan.md` 存在并遵循固定字段
- 每轮在 `orchestrator/memory/project_history.md` 留痕（说明改了什么/为什么）
- evidence:
- Iteration 1: MAIN 生成 dev_plan 快照并追加本轮 history_append；待 REVIEW 复核后转 VERIFIED

### M0-T2: 审阅代理输出可核实证据
- status: DOING
- acceptance:
- `orchestrator/reports/report_review.md` 包含可复现的命令与关键输出摘要
- 进度核实：逐条对照 dev_plan 的任务给出 PASS/FAIL 与证据
- evidence:

---

## Milestone M1: 需求与现状取证（Project 重构）

### M1-T1: 阅读关键文档并提炼重构目标/约束
- status: DOING
- acceptance:
- 逐份阅读并提炼（至少涵盖）：project 相关术语、边界、关键流程/数据流、约束（含快速失败/禁止防御性编程的影响）
- 明确与现有代码中 project 模块的映射点（文件/模块层面）
- evidence:

### M1-T2: 代码现状取证：定位 project 相关模块、入口与调用链
- status: DOING
- acceptance:
- 给出 project 相关目录/包/模块清单（含入口点与主要依赖关系）
- 给出至少 1 条从入口到 project 核心逻辑的调用链证据（文件+符号/行号或可复现搜索命令）
- 标注主要痛点（重复/耦合/SRP 违背等）并附定位证据
- evidence:

### M1-T3: 输出可执行的重构拆解（面向 dev_plan 的任务颗粒）
- status: TODO
- acceptance:
- 产出目标结构草图（目录/模块/职责边界）
- 产出迁移步骤（每步可独立验证，避免大爆炸式改动）
- 定义可验证的验收标准（测试、接口兼容性、关键行为不回归）
- evidence:

---

## Milestone M2: Project 模块重构（实现）

### M2-T1: 重构 project 核心领域模型/服务（按方案）
- status: TODO
- acceptance:
- 满足 M1-T3 定义的结构与职责边界（SRP/ISP）
- 消除重复逻辑（DRY），避免无用预留（YAGNI），保持实现简洁（KISS）
- 相关测试通过（以 TEST/REVIEW 证据为准）
- evidence:

### M2-T2: 重构 project 与 topone 集成层（按接口文档对齐）
- status: TODO
- acceptance:
- 依据 `doc/topone接口文档.md` 对齐请求/响应/错误语义
- 集成层与领域层解耦（DIP），不引入额外兜底逻辑
- 通过契约/集成测试（以 TEST/REVIEW 证据为准）
- evidence:

---

## Milestone M3: 测试与验证

### M3-T1: 补齐关键单元/集成测试（覆盖重构风险面）
- status: TODO
- acceptance:
- 关键用例测试先行（红-绿-重构），覆盖核心路径与重要边界
- 失败信息可定位（断言清晰，避免隐式兜底）
- evidence:

### M3-T2: REVIEW 复核并推进全部任务到 VERIFIED
- status: TODO
- acceptance:
- REVIEW 对照每条任务 acceptance 给出 PASS/FAIL 与证据
- 所有任务最终状态为 VERIFIED
- evidence:
