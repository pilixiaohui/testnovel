# Dev Plan (Snapshot)

> 本文件由 MAIN 维护。基于 Iteration 1-2 并行审阅结果制定。

## 约束（强制）
- 任务总数保持在几十条以内
- 每个任务含 status / acceptance / evidence
- status: TODO / DOING / BLOCKED / DONE / VERIFIED
- 仅 REVIEW 证据可 DONE → VERIFIED

---

## Milestone M1: 可构建 + 上下文契约

### M1-T1: 修复前端构建错误
- status: DONE
- acceptance:
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run build` → exit 0
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit` → exit 0
- evidence: DEV Iteration 2 自测PASS，build/test:unit均exit 0

### M1-T2: 统一项目上下文契约（root_id/branch_id/scene_id）
- status: DONE
- acceptance:
  - projectStore 管理 root_id/branch_id/scene_id 并与路由同步
  - 路由守卫确保必要参数存在
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit` → exit 0
- evidence: DEV Iteration 5 自测PASS，4个专项测试通过，50个单测通过，build成功

### M1-T3: 修复 API 请求体字段不匹配
- status: DONE
- acceptance:
  - resetBranch 使用 commit_id（非 target_commit_id）
  - fork_from_scene 包含 source_branch_id
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit` → exit 0
- evidence: DEV Iteration 7 自测PASS，专项测试2passed，全量52passed

---

## Milestone M2: 雪花→编辑器闭环

### M2-T1: 雪花流程持久化策略明确
- status: TODO
- acceptance:
  - 移除对不存在的 /snowflake/state 和 /snowflake/steps 端点依赖
  - 改用现有后端资源组合恢复（GET /roots/{id} + acts + chapters + anchors）
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:unit` → exit 0
- evidence:

### M2-T2: Step6 到 Editor 跳转携带 sceneId
- status: TODO
- acceptance:
  - Step6 完成后跳转 Editor 时携带有效 sceneId
  - Editor 能正确加载对应场景
- evidence:

---

## Milestone M3: 推演真实化

### M3-T1: Simulation 入口契约与路由一致
- status: TODO
- acceptance:
  - 路由 sceneId 必填或提供场景选择器
  - 无 sceneId 时有明确 UX（选择场景或返回）
- evidence:

### M3-T2: 多角色代理 UI 支持
- status: TODO
- acceptance:
  - Agent 列表可见且可切换
  - agents 来自 API 非静态 mock
- evidence:

---

## Milestone M4: 世界观真实化

### M4-T1: 实体类型对齐（id → entity_id）
- status: TODO
- acceptance:
  - WorldView 使用 entity_id/entity_type（与后端一致）
  - 移除 as unknown as 强转
- evidence:

### M4-T2: 实体创建表单化
- status: TODO
- acceptance:
  - 可输入 name/type 等字段创建实体
  - 创建成功后列表刷新
- evidence:

---

## Milestone M5: 测试覆盖率达标

### M5-T1: 修复 E2E 测试与实现契约不匹配
- status: TODO
- acceptance:
  - `cd /home/zxh/ainovel_v3/project/frontend && npx playwright test` → exit 0
- evidence:

### M5-T2: 覆盖率达到 80% 阈值
- status: TODO
- acceptance:
  - `cd /home/zxh/ainovel_v3/project/frontend && npm run test:coverage` → exit 0
- evidence:
