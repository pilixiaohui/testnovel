# Dev Plan (Snapshot)

> 本文件由 MAIN 维护（可覆盖编辑）。它是'当前计划与进度'的快照；事实证据以 `orchestrator/reports/report_review.md` 与 `orchestrator/memory/project_history.md` 为准。

## 约束（强制）
- 任务总数必须保持在'几十条'以内（少而硬）
- 每个任务块必须包含：`status / acceptance / evidence`
- status 只允许：TODO / DOING / BLOCKED / DONE / VERIFIED
- 可选字段：`verification_status: <PENDING_DEV_VALIDATION|DEV_VALIDATED|TEST_PASSED|VERIFIED|REVIEW_REJECTED>` 用于验证闭环跟踪
- 只有 **REVIEW 的证据** 才能把 DONE -> VERIFIED（evidence 必须引用 Iteration 与验证方式）

---

## Milestone M0: 引导与黑板契约

### M0-T1: 建立 dev_plan 状态机
- status: VERIFIED
- acceptance:
- `cat orchestrator/memory/dev_plan.md` → exit 0
- `rg -n '## Iteration 1' orchestrator/memory/project_history.md` → >=1
- evidence: Iteration 2 review PASS

### M0-T2: 审阅代理输出可核实证据
- status: VERIFIED
- acceptance:
- `rg -n '进度核实' orchestrator/reports/report_review.md` → >=1
- `rg -n 'PASS|FAIL' orchestrator/reports/report_review.md` → >=1
- evidence: Iteration 3 review PASS

---

## Milestone M1: 需求对齐与基线审阅

### M1-T1: 前后端基线审阅与差距矩阵
- status: VERIFIED
- acceptance:
- `rg --files /home/zxh/ainovel_v3/project/backend` → exit 0
- `rg --files /home/zxh/ainovel_v3/project/frontend` → exit 0
- `rg -n 'api/v1' /home/zxh/ainovel_v3/project/backend/app -g '*.py'` → exit 0
- `rg -n 'defineStore|createRouter|axios' /home/zxh/ainovel_v3/project/frontend/src -g '*.{ts,vue}'` → exit 0
- evidence: Iteration 2 review PASS

---

## Milestone M2: 后端实现对齐

### M2-T0: 后端结构路径对齐（ports/topone_client/models）
- status: VERIFIED
- acceptance:
- `test -f /home/zxh/ainovel_v3/project/backend/app/ports.py` → exit 0
- `test -f /home/zxh/ainovel_v3/project/backend/app/llm/topone_client.py` → exit 0
- `rg -n 'class .*BaseModel' /home/zxh/ainovel_v3/project/backend/app/models.py` → exit 0
- evidence: Iteration 5 review PASS

### M2-T1: 模型与 Schema 对齐（Pydantic + GQLAlchemy）
- status: DONE
- acceptance:
- `pytest -q tests/unit/test_schema_act_chapter.py` → exit 0
- `pytest -q tests/unit/test_schema_anchor.py` → exit 0
- `pytest -q tests/unit/test_schema_agent.py` → exit 0
- `pytest -q tests/unit/test_schema_simulation.py` → exit 0
- evidence: Iteration 10 dev PASS

### M2-T2: BDI/DM/Simulation/Renderer 服务实现
- status: TODO
- acceptance:
- `pytest -q tests/unit/test_character_agent.py` → exit 0
- `pytest -q tests/unit/test_world_master.py` → exit 0
- `pytest -q tests/unit/test_smart_renderer.py` → exit 0
- `pytest -q tests/unit/test_route_replanner.py` → exit 0
- evidence:

### M2-T3: API 端点对齐与兼容性
- status: TODO
- acceptance:
- `pytest -q tests/integration/test_anchor_api.py` → exit 0
- `pytest -q tests/integration/test_agent_api.py` → exit 0
- `pytest -q tests/integration/test_dm_api.py` → exit 0
- `pytest -q tests/integration/test_simulation_api.py` → exit 0
- `pytest -q tests/integration/test_snowflake_step5.py` → exit 0
- evidence:

### M2-T4: 存储层与时序/快照机制对齐
- status: TODO
- acceptance:
- `pytest -q tests/integration/test_act_chapter_storage.py` → exit 0
- `pytest -q tests/integration/test_anchor_storage.py` → exit 0
- `pytest -q tests/integration/test_agent_storage.py` → exit 0
- `pytest -q tests/integration/test_simulation_flow.py` → exit 0
- `pytest -q tests/integration/test_pacing_control.py` → exit 0
- evidence:

### M2-T5: 覆盖率最低线
- status: TODO
- acceptance:
- `pytest --cov=app --cov-report=term --cov-fail-under=60` → exit 0
- evidence:

---

## Milestone M3: 前端基础框架与核心页面

### M3-T1: 项目初始化与基础配置（Vite/Router/Pinia/Axios）
- status: TODO
- acceptance:
- `cd project/frontend && npm run build` → exit 0
- evidence:

### M3-T2: API 层 + types + stores
- status: TODO
- acceptance:
- `cd project/frontend && npm run test:unit` → exit 0
- evidence:

### M3-T3: 核心视图与业务组件（Snowflake/Simulation/Editor/World）
- status: TODO
- acceptance:
- `cd project/frontend && npm run test:integration` → exit 0
- evidence:

### M3-T4: 通用组件与路由/样式
- status: TODO
- acceptance:
- `cd project/frontend && npm run test:unit` → exit 0
- evidence:

---

## Milestone M4: 前端测试与 Playwright 验证

### M4-T1: 单元与集成测试补齐
- status: TODO
- acceptance:
- `cd project/frontend && npm run test:unit` → exit 0
- `cd project/frontend && npm run test:integration` → exit 0
- evidence:

### M4-T2: E2E（Playwright）全流程验证
- status: TODO
- acceptance:
- `cd project/frontend && npm run test:e2e` → exit 0
- `cd project/frontend && npm run test:coverage` → exit 0
- evidence:

---

## Milestone M5: 全量验收

### M5-T1: Review 全量验收
- status: TODO
- acceptance:
- `pytest -q -rs` → exit 0
- `pytest -q tests/integration/` → exit 0
- `cd project/frontend && npm run build` → exit 0
- `cd project/frontend && npm run test:e2e` → exit 0
- evidence:
