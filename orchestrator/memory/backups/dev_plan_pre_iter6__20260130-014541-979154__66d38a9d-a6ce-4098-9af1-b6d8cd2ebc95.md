# Dev Plan (Snapshot)

> 本文件由 MAIN 维护。事实证据以 `orchestrator/reports/report_review.md` 与 `orchestrator/memory/project_history.md` 为准。

## 约束（强制）
- 任务总数保持在几十条以内
- 每个任务块必须包含：`status / acceptance / evidence`
- status 只允许：TODO / DOING / BLOCKED / DONE / VERIFIED
- 只有 REVIEW 的证据才能把 DONE -> VERIFIED

## 用户决策记录
- Iteration 2: 10章约束策略 → prompt_constraint（LLM提示词控制章节数，不做服务端硬约束，支持任意章节数量）

---

## Milestone M1: Snowflake引擎接口统一

### M1-T1: 引擎契约测试
- status: DOING
- acceptance:
  - `pytest project/backend/tests/unit/test_snowflake_engine_contract.py -v` → 测试可运行
  - 覆盖ToponeGateway/LLMEngine/LocalStoryEngine的Step5a/Step5b/锚点方法存在性
- evidence:

### M1-T2: ToponeGateway补齐Step5方法
- status: TODO
- acceptance:
  - ToponeGateway实现generate_act_list/generate_chapter_list/generate_story_anchors
  - `pytest project/backend/tests/unit/test_snowflake_engine_contract.py -v` → ToponeGateway相关用例绿灯
- evidence:

### M1-T3: LLMEngine/LocalStoryEngine补齐或明确不支持
- status: TODO
- acceptance:
  - LLMEngine实现三个方法或抛出NotImplementedError
  - LocalStoryEngine同上
  - 契约测试全部绿灯
- evidence:

---

## Milestone M2: 锚点类型扩展

### M2-T1: 扩展VALID_ANCHOR_TYPES
- status: TODO
- acceptance:
  - `VALID_ANCHOR_TYPES`包含inciting_incident/midpoint/climax/resolution
  - `VALID_ANCHOR_CONSTRAINTS`包含hard/soft/flexible
  - `pytest project/backend/tests/unit/test_memgraph_storage_contract.py -v -k anchor` → 绿灯
- evidence:

### M2-T2: 锚点存储测试
- status: TODO
- acceptance:
  - 测试覆盖所有新增锚点类型的创建/查询
  - 集成测试通过
- evidence:

---

## Milestone M3: E2E流程验证

### M3-T1: 更新E2E脚本支持可配置章节数
- status: TODO
- acceptance:
  - `project/scripts/ten_chapter_novel_e2e.py`支持--chapters参数
  - 移除硬编码10章断言，改为参数化验证
  - `python project/scripts/ten_chapter_novel_e2e.py --chapters 10 --dry-run` → 成功
- evidence:

### M3-T2: Snowflake六步流程集成测试
- status: TODO
- acceptance:
  - `pytest project/backend/tests/integration/test_snowflake_step5.py -v` → 绿灯
  - 覆盖Step1-Step5b完整流程
- evidence:

### M3-T3: 模拟/渲染/反馈流程验证
- status: TODO
- acceptance:
  - E2E脚本覆盖simulation/render/feedback调用
  - 各步骤返回非空结果
- evidence:

---

## Milestone M4: 10章赛博朋克小说生成

### M4-T1: 执行完整小说生成流程
- status: TODO
- acceptance:
  - 使用测试内容「名为何方的时空旅人穿越到赛博朋克世界的日常生活故事」
  - 生成10章完整小说（通过LLM提示词控制）
  - 输出包含：Root/Characters/Acts/Chapters/Anchors/渲染正文
- evidence:

### M4-T2: 输出质量验收
- status: TODO
- acceptance:
  - 每章渲染正文1000-2000字
  - 锚点包含inciting_incident/midpoint/climax/resolution
  - 角色档案完整（至少主角+2配角）
- evidence:

### M4-T3: 前端展示验证
- status: TODO
- acceptance:
  - SnowflakeView正确展示生成结果
  - 无控制台错误
  - 章节列表可点击查看详情
- evidence:
