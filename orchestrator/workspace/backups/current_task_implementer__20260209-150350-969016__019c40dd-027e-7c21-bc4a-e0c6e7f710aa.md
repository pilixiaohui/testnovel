# Current Task (Iteration 4)
assigned_agent: IMPLEMENTER
self_test: enabled

## 任务目标
前3轮迭代修复了基础设施问题（构建通过、类型错误、上下文同步），但用户报告的8个核心功能问题一个都没有实质修复。本轮必须聚焦功能层面的实际修复。

## 严格要求
**本轮禁止只修基础设施问题。必须修改组件模板和Store逻辑，让用户在浏览器中能看到实际变化。**

## 必须完成的功能修复（按优先级）

### 修复1: 雪花卡片显示完整信息（最高优先级）
**现状**: CharacterCard/SceneCard/ActCard/ChapterCard 只显示名字列表
**要求**: 
- CharacterCard 必须显示: name, ambition, conflict, epiphany, voice_dna, one_sentence_summary
- SceneCard 必须显示: title, sequence_index, expected_outcome, conflict_type
- ActCard 必须显示: title, purpose, tone, sequence
- ChapterCard 必须显示: title, focus, sequence, pov_character_id
- Step6Panel 的锚点必须显示: anchor_type, description, constraint_type, required_conditions, achieved
**做法**: 直接修改各 Card 组件的 template，添加缺失字段的渲染

### 修复2: 项目新建功能
**现状**: HomeView 无法新建项目
**要求**: 
- HomeView 有创建项目入口（按钮/表单）
- 点击后调用后端 API 创建 root 节点
- 创建成功后跳转到雪花页面并设置项目上下文
**做法**: 检查 HomeView 的新建逻辑，修复 API 调用和路由跳转

### 修复3: 设置页显示真实LLM配置
**现状**: SettingsView 显示硬编码的默认配置
**要求**: 从后端 API 获取真实的 LLM 配置（模型名、端点等）并显示
**做法**: 检查后端是否有 /config 或 /settings API，在 SettingsView 中调用并渲染

### 修复4: 提示词显示实际值
**现状**: 提示词编辑器显示硬编码默认值
**要求**: 从后端 snowflakeApi.getPrompts 获取实际使用的提示词并显示
**做法**: 在 SnowflakeView 的提示词编辑区域调用 getPrompts API

### 修复5: 标签页切换
**现状**: 切换标签页时可能报错
**要求**: 各 View 切换时正确初始化状态，无项目上下文时显示提示而非报错
**做法**: 在各 View 的 onMounted 中检查 projectStore.hasProject，无项目时显示引导

### 修复6: 图信息提取与推演
**现状**: StateExtractPanel 和 SimulationView 的 API 调用可能不正确
**要求**: 确保 stateExtract 和 simulation API 调用链正确
**做法**: 检查并修复 API 调用参数和响应处理

### 修复7: 原始信息和解析结果显示
**要求**: 在雪花步骤中支持查看 LLM 返回的原始文本
**做法**: 在 snowflakeStore 中保存 raw_output，在 UI 中添加"查看原始结果"的展开/折叠区域

## 验收标准
- 各雪花卡片组件显示完整字段（不仅仅是名字）
- HomeView 可以新建项目
- SettingsView 显示从后端获取的配置
- 提示词编辑器显示实际提示词
- 标签页切换无报错
- 前端构建通过 + 全量单测通过

## 约束
- 本轮必须修改组件 template 让用户看到实际变化
- 禁止只修类型错误或配置问题而不改功能
- 每个修复都要有对应测试验证

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687
- 测试执行配置:
  - 前端开发端口: 5185
  - 服务启动等待: 6秒
  - unit测试超时: 120秒
  - integration测试超时: 300秒
  - e2e测试超时: 600秒

