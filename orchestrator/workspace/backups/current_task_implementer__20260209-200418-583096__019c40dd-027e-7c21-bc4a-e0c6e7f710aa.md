# Current Task (Iteration 16)
assigned_agent: IMPLEMENTER
self_test: enabled

## 任务目标
SYNTHESIZER Iteration 15 返回 BLOCKED，两个核心问题：
1. 后端 127.0.0.1:8000 不可达（验证器无法连接）
2. /api/v1/roots 端点多次返回 500

## 必须修复的问题

### 1. /api/v1/roots 返回 500
- 现象：EDGE_CASE_TESTER 多次调用 /api/v1/roots 返回 500 内部错误
- 这个问题在之前多轮都出现过，说明之前的修复不彻底
- 要求：
  a) 调研 /api/v1/roots 的 GET 和 POST 端点实现
  b) 找出所有可能导致 500 的代码路径（未捕获异常、依赖注入失败、数据库连接问题等）
  c) 确保所有异常都被正确捕获并返回合适的 HTTP 状态码（400/422/503）
  d) 特别注意：当 Memgraph 不可用时，应返回 503 而非 500

### 2. 后端启动可靠性
- 现象：验证器无法连接 127.0.0.1:8000
- 可能原因：后端启动时依赖检查失败导致进程退出、端口被占用、启动脚本问题
- 要求：
  a) 检查后端 main.py 的启动逻辑，确保启动时的依赖检查（Memgraph连接等）不会导致进程崩溃
  b) 确保后端在 Memgraph 不可用时仍能启动（降级模式），只在实际调用时返回 503
  c) 验证后端可以通过 uvicorn 正常启动并响应 /docs 端点

### 3. 补充自测验证
- 在修复后，用单命令方式启动后端并验证：
  a) 后端进程可正常启动
  b) /docs 端点返回 200
  c) /api/v1/roots GET 端点不返回 500（即使数据库为空也应返回空列表或 503）

## 验收标准
- 后端单元测试全部通过
- 前端单元测试全部通过
- 前端 build 成功
- /api/v1/roots GET 不返回 500（返回 200 空列表或 503）
- /api/v1/roots POST 对异常输入返回 400/422 而非 500
- 后端可通过 uvicorn 正常启动

## 约束条件
- 先调研再修复
- 不要添加过度的兜底逻辑，但数据库连接失败应返回 503
- 保持快速失败原则：业务逻辑错误快速失败，基础设施问题返回 503

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687
- 测试执行配置:
  - 前端开发端口: 5185
  - 服务启动等待: 6秒
  - unit测试超时: 120秒
  - integration测试超时: 300秒
  - e2e测试超时: 600秒

