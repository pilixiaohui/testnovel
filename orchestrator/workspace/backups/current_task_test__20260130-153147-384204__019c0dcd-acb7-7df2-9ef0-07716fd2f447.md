# Current Task (Iteration 3)
assigned_agent: TEST
work_mode: design

## 任务目标
为M2-T2章节渲染API补充字数越界测试用例，覆盖REVIEW指出的测试缺失场景

## 测试需求
在 `project/backend/tests/integration/test_chapter_render_api.py` 中补充以下测试：

### 1. 字数不足测试
- 场景：rendered_content字数<1800（如1799字符）
- 预期：status_code=400
- 断言：response.json()["detail"] 包含"字数不足"、实际字数、"1800-2200"、"不含标点空白"

### 2. 字数超限测试
- 场景：rendered_content字数>2200（如2201字符）
- 预期：status_code=400
- 断言：response.json()["detail"] 包含"字数超限"、实际字数、"1800-2200"、"不含标点空白"

### 3. 统计口径验证测试（可选但推荐）
- 场景：content含大量标点/空白，实际有效字符在1800-2200范围内
- 预期：status_code=200
- 目的：验证计数口径确实排除标点空白，而非简单len()

## 被测代码
- `project/backend/app/main.py:_count_rendered_chars()` (约120行)
- `project/backend/app/main.py` 渲染接口字数校验逻辑 (约625行)

## 实现参考
现有测试使用 `_make_content(n)` 辅助函数生成指定长度内容，可复用或扩展

## 验收标准
1. `cd project/backend && /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/integration/test_chapter_render_api.py -v` → 新增测试可运行
2. 当前应为红灯状态（若实现有bug）或绿灯（若实现正确）
3. 测试用例覆盖字数不足、字数超限两个核心场景

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
