# Current Task (Iteration 12)
assigned_agent: IMPLEMENTER
self_test: enabled

## 任务目标
SYNTHESIZER Iteration 11 返回 REWORK，本轮聚焦修复验证器发现的具体 API 错误。

## 必须修复的具体 API 错误（按优先级排序）

### 1. 保存接口返回 400 "logline required"
- 现象：保存项目时后端返回 400，提示 logline 字段缺失
- 期望：保存接口正确接收前端发送的数据格式，logline 字段正确传递
- 调研方向：检查保存端点的请求体校验逻辑，确认前端发送的字段名与后端期望是否一致

### 2. /snowflake/step4 返回 422
- 现象：雪花第4步（场景生成）调用后端返回 422 校验错误
- 期望：step4 请求体格式正确，后端正常处理并返回场景数据
- 调研方向：检查 step4 端点的 Pydantic 模型定义与前端发送的 payload 是否匹配

### 3. /roots/*/anchors 返回 404
- 现象：获取锚点列表时后端返回 404
- 期望：锚点 API 端点存在且可正常返回数据
- 调研方向：检查路由注册，确认 anchors 端点是否正确挂载

### 4. /state/extract 返回 404
- 现象：状态提取 API 返回 404
- 期望：state extract 端点存在且可正常调用
- 调研方向：检查路由注册，确认 state/extract 端点路径

### 5. /api/v1/roots 对特殊输入返回 500
- 现象：XSS/SQL注入/Unicode 等特殊字符输入到 roots 创建接口时触发 500 内部错误
- 期望：特殊字符输入被正确校验，返回 400/422 而非 500
- 调研方向：检查 roots 创建端点的输入校验，确保异常输入不会导致未捕获异常

## 验收标准
- 保存接口可正常保存项目数据（不返回 400）
- step4 可正常生成场景（不返回 422）
- anchors 端点可正常返回锚点数据（不返回 404）
- state/extract 端点可正常调用（不返回 404）
- roots 创建接口对特殊字符输入返回 400/422 而非 500
- 后端单元测试全部通过
- 前端单元测试全部通过
- 前端 build 成功

## 约束条件
- 先调研每个错误的实际原因再修复，不要盲目改代码
- 不要为了通过测试而削弱校验逻辑
- 保持 API 接口的 snake_case 字段命名约定
- 快速失败原则：不添加兜底逻辑掩盖错误

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687
- 测试执行配置:
  - 前端开发端口: 5185
  - 服务启动等待: 6秒
  - unit测试超时: 120秒
  - integration测试超时: 300秒
  - e2e测试超时: 600秒

