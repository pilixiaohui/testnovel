# Current Task (Iteration 8)
assigned_agent: IMPLEMENTER
self_test: enabled

## 任务目标
SYNTHESIZER Iteration 7 结论BLOCKED，EDGE_CASE_TESTER已PASS(6/6)，但TEST_RUNNER发现多个后端API错误和持久化问题需要修复。

## 必须修复的问题（按优先级）

### 1. 后端API错误（TEST_RUNNER FAIL）
- **Step5a返回500**：POST /api/v1/snowflake/step5a 返回500，检查step5a的handler实现，可能是参数格式不匹配或内部异常未捕获
- **anchors返回404**：GET/POST /api/v1/roots/{id}/anchors 返回404，检查路由是否正确注册，可能是路由路径不匹配
- **state/extract返回400**：POST /api/v1/state/extract 返回400，检查请求体格式是否与后端schema匹配
- **项目切换后数据丢失**：切换项目后之前的数据不可恢复，检查projectStore的持久化逻辑和后端数据存储

### 2. 前端持久化问题
- 项目切换后数据丢失，检查：
  - projectStore.setProject 是否正确保存到localStorage
  - snowflakeStore 在项目切换时是否正确重新加载数据
  - 后端是否正确存储和返回项目数据

### 3. ANTI_CHEAT问题
- 硬编码URL/TODO/注释命中集中在node_modules，这是误报
- 但需要确认src/目录下是否还有硬编码URL或空断言
- 检查并清理前端src/和后端app/目录下的：
  - 硬编码URL（应使用环境变量）
  - 空断言（expect()无实际检查）
  - 未处理的TODO注释

## 调研方法
- 先启动后端服务，用curl测试失败的API端点，确认错误原因
- 检查后端路由注册（main.py中的router include）
- 检查请求/响应schema匹配
- 检查前端持久化逻辑

## 验收标准
- Step5a API正常返回（非500）
- anchors API正常返回（非404）
- state/extract API正常返回（非400）
- 项目切换后数据不丢失
- src/目录下无硬编码URL
- 测试中无空断言
- 前端构建通过 + 全量单测通过
- 后端单测通过

## 约束
- 聚焦修复验证器发现的具体问题
- 不做无关重构
- 每个修复都要有测试验证

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687
- 测试执行配置:
  - 前端开发端口: 5185
  - 服务启动等待: 6秒
  - unit测试超时: 120秒
  - integration测试超时: 300秒
  - e2e测试超时: 600秒

