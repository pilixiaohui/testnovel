# Current Task (Iteration 12)
assigned_agent: IMPLEMENTER
self_test: enabled

## 任务目标
修复后端API边界输入导致500错误的问题，将异常路径收敛为可预期的4xx业务校验失败。

## 问题清单（来自EDGE_CASE_TESTER）
1. `/api/v1/settings/llm` 边界输入（负数temperature/max_tokens、超长字符串、特殊字符）返回500而非4xx
2. `/api/v1/snowflake/step1` 边界输入返回500而非4xx
3. 多个roots相关接口在类型错误/边界值场景下返回500
4. 快速重复提交触发后端500
5. XSS/Unicode/SQL注入样式输入未被校验拦截，导致500

## 需求边界
- 输入：各API端点接收的边界值、非法类型、特殊字符输入
- 输出：4xx状态码 + 明确的错误信息JSON（而非500 Internal Server Error）
- 行为：在API层（路由/模型校验）拦截非法输入，返回结构化错误响应

## 测试场景
1. 正常场景：合法输入正常处理，返回2xx
2. 边界值：负数、零、超大数值、超长字符串、空字符串 → 返回422/400
3. 类型错误：字符串传给数值字段、数组传给字符串字段 → 返回422
4. 特殊字符：XSS标签、Unicode特殊字符、SQL注入模式 → 返回422/400（不触发500）
5. 并发/重复：快速重复提交同一请求 → 幂等处理或返回409，不触发500

## 验收标准（抽象描述）
- 所有API端点在接收边界/非法输入时返回4xx而非500
- 错误响应包含结构化的错误信息（如字段名、错误原因）
- 现有单元测试和集成测试仍然全部通过
- 前端控制台无持续error（边界输入场景下）

## 约束条件
- 优先利用FastAPI/Pydantic的内置校验机制（Field validators、conint、constr等），避免手写大量校验逻辑
- 不改变正常业务流程的API行为
- 不改变现有API接口契约（请求/响应结构）
- 聚焦EDGE_CASE_TESTER报告的失败接口，不做全局大范围改动

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687
- 测试执行配置:
  - 前端开发端口: 5185
  - 服务启动等待: 6秒
  - unit测试超时: 120秒
  - integration测试超时: 300秒
  - e2e测试超时: 600秒

