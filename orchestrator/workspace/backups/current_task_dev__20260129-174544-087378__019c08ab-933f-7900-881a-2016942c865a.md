# Current Task (Iteration 5)
assigned_agent: DEV
self_test: enabled

## 任务目标
根据 FINISH_REVIEW 报告修复前后端 API 契约不一致与核心实现问题。

## 问题清单（按优先级）

### P0-1: 前后端 API 契约修复
1. **实体 API 对齐**：前端 `api/entity.ts` 调用 update/delete 但后端无对应端点
   - 方案：移除前端未使用的 update/delete 调用，或在后端补齐端点
   - 相关文件：`project/frontend/src/api/entity.ts:35`，`project/backend/app/main.py:1023`

2. **场景 diff API 修复**：前端 diffScene 缺少必填 commit 参数
   - 方案：前端调用时补齐 from/to commit 参数
   - 相关文件：`project/frontend/src/api/scene.ts:43`，`project/backend/app/main.py:1103`

3. **推演接口返回结构对齐**：前端期望结构与后端返回不匹配
   - 方案：修改前端适配后端返回结构
   - 相关文件：`project/frontend/src/views/SimulationView.vue:133`，`project/backend/app/main.py:694`

### P0-2: 锚点生成流程修复
- Step6 应调用 POST 生成锚点，当前仅 GET 列表
- 相关文件：`project/frontend/src/stores/snowflake.ts:139`，`project/frontend/src/api/anchor.ts:50`

### P0-3: 测试配置修复
1. **Vitest 配置**：在 `vitest.config.ts` 引入 `@vitejs/plugin-vue`
   - 相关文件：`project/frontend/vitest.config.ts:1`

2. **移除 gqlalchemy stub**：删除或重命名本地 stub 以使用真实依赖
   - 相关文件：`project/backend/gqlalchemy/__init__.py:16`

### P0-4: FeedbackDetector 逻辑修复
- 停滞应触发 stagnation 而非被 divergence 截获
- 相关文件：`project/backend/app/services/feedback_detector.py:16`

## 验收标准
必须依次执行以下命令并在报告中汇报每项结果：
1. `cd /home/zxh/ainovel_v3/project/frontend && npm run build` → 构建成功
2. `cd /home/zxh/ainovel_v3/project/frontend && npm run test:e2e` → E2E 测试通过
3. `cd /home/zxh/ainovel_v3/project/frontend && npm run test:integration` → 集成测试可运行（修复 Vitest 配置后）
4. 使用 Playwright MCP 访问 http://localhost:5173/snowflake 验证雪花流程页面可正常显示

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687

