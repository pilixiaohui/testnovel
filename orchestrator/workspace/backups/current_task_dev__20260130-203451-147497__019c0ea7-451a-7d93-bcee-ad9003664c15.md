# Current Task (Iteration 22)
assigned_agent: DEV
self_test: enabled

## 任务目标
修复Vite代理配置问题，使前端开发服务器能正确代理API请求到后端

## 问题根因（来自REVIEW报告）
`VITE_API_BASE_URL=/api/v1` 被同时用于：
1. 前端axios的baseURL（路径前缀）- 正确用法
2. Vite proxy的target（需要完整URL）- 错误用法

相对路径作为proxy target导致：`Cannot read properties of null (reading 'split')`

## 修复方案

### 1. 新增环境变量
在 `project/frontend/.env.development` 中添加：
```
VITE_API_PROXY_TARGET=http://127.0.0.1:8000
```

### 2. 修改vite.config.ts
```ts
// 读取proxy target配置
const apiProxyTarget = env.VITE_API_PROXY_TARGET

// 开发模式下强制要求配置
if (mode === 'development' && !apiProxyTarget) {
  throw new Error('VITE_API_PROXY_TARGET is required in development mode')
}

// proxy配置使用正确的target
server: {
  proxy: {
    '/api': {
      target: apiProxyTarget,
      changeOrigin: true,
    }
  }
}
```

### 3. 保持axios baseURL不变
`src/api/index.ts` 中的 `VITE_API_BASE_URL` 用法保持不变（作为路径前缀）

## 验收标准
1. `cd project/frontend && npm run dev -- --host 127.0.0.1 --port 5179` → 启动成功无报错
2. 启动后 `curl http://127.0.0.1:5179/api/v1/snowflake/step1` → 返回后端数据（非Vite错误页面）
3. 缺失VITE_API_PROXY_TARGET时启动应快速失败

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 前端目录: /home/zxh/ainovel_v3/project/frontend
- 后端需运行在: http://127.0.0.1:8000
