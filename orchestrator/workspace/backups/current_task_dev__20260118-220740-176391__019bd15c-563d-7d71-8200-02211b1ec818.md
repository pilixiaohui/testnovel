# Current Task (Iteration 7)
assigned_agent: DEV

## 目标
- 启动并推进 M2-T3（Memgraph 存储落地）：实现“时序状态 + world_state 查询 + 快照”的最小闭环，并提供可复现的本地集成验证方式。

## 范围
- 后端：`project/backend/app/**`
- 允许新增本地开发所需：docker-compose 文件、Memgraph 客户端依赖、集成测试
- 不要求本轮切换默认存储为 Memgraph（避免破坏性变更）；但若提供切换开关，必须显式失败、禁止兜底

## 约束
- 快速失败：Memgraph 选择/连接失败必须显式报错；禁止静默回退到 Kuzu
- 禁止防御性编程：不添加吞异常/默认值续跑
- 编码 UTF-8（无 BOM）

## 任务步骤（按 TDD）
1) 集成测试先行（红）
- 新增 Memgraph 集成测试（可放 `project/backend/tests/`，文件名自定），覆盖最小闭环：
  - 写入/读取 entity 状态（包含 start_scene_seq/end_scene_seq）
  - 按 scene_seq 查询 world_state
  - 生成并读取 snapshot
- 先让测试在“未实现 Memgraph 存储”时失败（红），失败信息要直指缺失实现。

2) 本地集成环境
- 增加可复现的 Memgraph 启动方式（优先 docker-compose），并在 README/注释中写清命令：
  - 启动/停止
  - 运行集成测试

3) 实现 Memgraph 存储最小闭环（绿）
- 在 `project/backend/app/storage/` 新增 Memgraph 实现（命名自定），实现对应的数据模型与查询：
  - 时序边/区间：start_scene_seq/end_scene_seq
  - world_state(scene_seq) 查询
  - snapshot 生成与查询
- 过程中保持 KISS：只实现测试所需的最小能力。

4) 回归
- 保证通过：
  - Memgraph 集成测试（在 Memgraph 运行时）
  - 全量后端测试：`python -m pytest -q`

## 验收标准
- 提供可复现的本地验证方式（至少包含：启动 Memgraph + 跑集成测试的命令）
- Memgraph 最小闭环能力具备，并有测试覆盖（先红后绿）
- 全量 pytest 通过（不得引入回归）
- 未引入兜底/吞异常/默认续跑
