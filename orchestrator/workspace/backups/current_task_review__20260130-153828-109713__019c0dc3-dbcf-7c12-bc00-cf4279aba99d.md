# Current Task (Iteration 4)
assigned_agent: REVIEW
review_mode: single

## 任务目标
验收M2-T2章节渲染API字数约束功能（最终验收）

## 验收范围

### M2-T2: 章节渲染API（/chapters/{id}/render）
- 验收命令: `cd project/backend && /home/zxh/ainovel_v3/project/backend/.venv/bin/python -m pytest tests/integration/test_chapter_render_api.py -v`
- 预期: 全部PASS（6个用例）
- 实现文件: `project/backend/app/main.py`（约120行`_count_rendered_chars`函数，约625行字数校验逻辑）
- 测试文件: `project/backend/tests/integration/test_chapter_render_api.py`

## 代码审查要求（必做）

### 1. 实现代码质量检查
- `_count_rendered_chars`函数：统计口径是否正确排除空白与Unicode标点（category P*）
- 字数范围校验：1800-2200边界是否为闭区间（含边界值）
- 错误响应：400状态码，detail包含实际字数、期望范围、统计口径说明
- 常量定义：1800/2200是否应提取为常量（次要改进项，不阻塞验收）

### 2. 测试代码合理性检查
- 覆盖场景：正常范围、字数不足(<1800)、字数超限(>2200)、统计口径验证
- 断言完整性：status_code + detail内容关键词
- 无作弊：测试是否真正调用API而非mock绕过

### 3. 作弊代码检测
- 实现是否真正执行字数统计，而非硬编码返回
- 测试数据是否合理（1799/2201边界值）

## 验收标准
1. 验收命令全部PASS（6 passed）
2. 实现代码质量审查通过
3. 测试覆盖充分，无作弊
4. 无架构问题

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
