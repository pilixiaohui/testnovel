# Current Task (Iteration 2)
assigned_agent: DEV
self_test: enabled

## 任务目标
重构前端 API 层，按 `doc/frontend_implementation_spec.md` 附录 C 统一命名与模块组织。

## 实现要求

### 1. 重构 API 模块结构
将 `project/frontend/src/api/` 目录按规格重组为以下文件：
- `index.ts` - Axios 实例配置（baseURL、timeout、拦截器）
- `snowflake.ts` - 雪花流程 API（6 个函数）
- `anchor.ts` - 锚点管理 API（4 个函数）
- `agent.ts` - 角色代理 API（4 个函数）
- `dm.ts` - DM 裁决 API（4 个函数）
- `simulation.ts` - 推演引擎 API（5 个函数）
- `scene.ts` - 场景管理 API（8 个函数）
- `entity.ts` - 实体管理 API（3 个函数）
- `subplot.ts` - 支线管理 API（3 个函数）
- `branch.ts` - 分支管理 API（9 个函数）
- `commit.ts` - 提交管理 API（2 个函数）
- `llm.ts` - LLM 与逻辑检查 API（4 个函数）
- `feedback.ts` - 递归反馈 API（1 个函数）

### 2. API 函数命名规范
严格按规格附录 C 命名，示例：
```typescript
// snowflake.ts
export const snowflakeApi = {
  generateLoglines(idea: string): Promise<string[]>,
  generateStructure(logline: string): Promise<SnowflakeRoot>,
  generateCharacters(root: SnowflakeRoot): Promise<CharacterSheet[]>,
  generateScenes(root, characters): Promise<Step4Result>,
  generateActs(rootId, root, characters): Promise<Act[]>,
  generateChapters(rootId, root, characters): Promise<Chapter[]>,
  listActs(rootId: string): Promise<Act[]>,
  listChapters(actId: string): Promise<Chapter[]>
}
```

### 3. 后端端点映射
确保每个 API 函数正确映射到后端端点，参考规格附录 C.1-C.14。

### 4. 保持向后兼容
若现有组件依赖旧 API 函数，可暂时保留旧函数作为别名，但新代码必须使用规范命名。

## 验收标准
必须依次执行以下命令并在报告中汇报每项结果：
1. `ls -la project/frontend/src/api/` → 应包含 13 个 .ts 文件
2. `grep -c 'export const snowflakeApi' project/frontend/src/api/snowflake.ts` → 应返回 1
3. `grep -c 'export const anchorApi' project/frontend/src/api/anchor.ts` → 应返回 1
4. `grep -c 'export const agentApi' project/frontend/src/api/agent.ts` → 应返回 1
5. `grep -c 'export const dmApi' project/frontend/src/api/dm.ts` → 应返回 1
6. `grep -c 'export const simulationApi' project/frontend/src/api/simulation.ts` → 应返回 1
7. `grep -c 'export const sceneApi' project/frontend/src/api/scene.ts` → 应返回 1
8. `grep -c 'export const entityApi' project/frontend/src/api/entity.ts` → 应返回 1
9. `grep -c 'export const subplotApi' project/frontend/src/api/subplot.ts` → 应返回 1
10. `grep -c 'export const branchApi' project/frontend/src/api/branch.ts` → 应返回 1
11. `grep -c 'export const commitApi' project/frontend/src/api/commit.ts` → 应返回 1
12. `grep -c 'export const llmApi' project/frontend/src/api/llm.ts` → 应返回 1
13. `grep -c 'export const feedbackApi' project/frontend/src/api/feedback.ts` → 应返回 1
14. `cd project/frontend && npm run build` → 构建成功，无 TypeScript 错误

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687

