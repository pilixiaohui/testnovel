# Current Task (Iteration 13)
assigned_agent: DEV
self_test: enabled

## 任务目标
实现章节渲染API端点 POST /api/v1/chapters/{chapter_id}/render

## 背景
- TEST已创建测试：`project/backend/tests/integration/test_chapter_render_api.py`
- 当前红灯原因：端点不存在，所有请求返回404
- 需要实现：根据chapter_id获取章节，调用LLM渲染生成正文

## 实现要求
1. 在`project/backend/app/main.py`中添加新端点：
   - POST /api/v1/chapters/{chapter_id}/render
   - 从Memgraph获取章节信息（get_chapter）
   - 章节不存在返回404
   - 调用LLM渲染服务生成章节正文（可复用现有render逻辑或ToponeGateway）
   - 返回{rendered_content: str}，字数应在1800-2200范围
   - 渲染失败返回400
2. 渲染逻辑：
   - 基于章节的title/summary/outline等信息构造渲染prompt
   - 调用LLM生成2000字左右的章节正文
   - 可参考现有scene render逻辑
3. 不做字数强校验（由E2E测试验证），但prompt应明确要求2000字

## 被修改代码
- `project/backend/app/main.py` - 新增章节渲染端点
- 可能涉及：`project/backend/app/llm/prompts/` - 章节渲染prompt

## 验收标准
1. `cd project/backend && MEMGRAPH_HOST=localhost MEMGRAPH_PORT=7687 python -m pytest tests/integration/test_chapter_render_api.py -v` → 3个测试全部PASS
2. 成功渲染返回200和rendered_content
3. 章节不存在返回404
4. 渲染失败返回400

## 执行环境
- 工作目录: /home/zxh/ainovel_v3
- 代码目录: /home/zxh/ainovel_v3/project/backend
- Python: /home/zxh/ainovel_v3/project/backend/.venv/bin/python
- 环境变量:
  - MEMGRAPH_HOST=localhost
  - MEMGRAPH_PORT=7687

