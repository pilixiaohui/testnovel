# Current Task (Iteration 6)
assigned_agent: TEST
work_mode: design

## 任务目标
为章节审核API编写集成测试（M3-T1）

## 测试需求
根据REVIEW审阅确认的接口设计，编写以下测试用例：

### 接口定义
- 路径：`POST /api/v1/chapters/{chapter_id}/review`
- 请求体：`{"status": "approved" | "rejected"}`
- 成功响应：`{"id": chapter_id, "review_status": "<approved|rejected>"}`

### 测试用例清单
1. **test_review_chapter_approved** - 审核通过场景
   - 创建chapter（默认review_status=pending）
   - POST /chapters/{id}/review {"status":"approved"}
   - 断言响应200，review_status="approved"
   - 断言持久化：GET /chapters/{id} 返回review_status="approved"

2. **test_review_chapter_rejected** - 审核拒绝场景
   - 创建chapter
   - POST /chapters/{id}/review {"status":"rejected"}
   - 断言响应200，review_status="rejected"
   - 断言持久化验证

3. **test_review_chapter_invalid_status** - 无效状态返回400
   - 创建chapter
   - POST /chapters/{id}/review {"status":"invalid_value"}
   - 断言响应400（注意：需手动校验而非Pydantic 422）

4. **test_review_chapter_not_found** - 章节不存在返回404
   - POST /chapters/nonexistent-uuid/review {"status":"approved"}
   - 断言响应404

5. **test_review_chapter_idempotent** - 幂等性测试
   - 创建chapter并approve
   - 再次approve
   - 断言响应200，状态仍为approved

## 测试文件
- 路径：`project/backend/tests/integration/test_chapter_review_api.py`
- 参考：`tests/integration/test_chapter_persistence.py` 的fixture用法
- 使用：`memgraph_storage` fixture（conftest.py已提供）

## 被测代码（待实现）
- `project/backend/app/main.py` - 新增review端点

## 验收标准
1. `cd project/backend && python -m pytest tests/integration/test_chapter_review_api.py -v` → 测试可运行
2. 当前应为红灯（端点未实现，预期5个测试全部FAIL或ERROR）
3. 测试代码结构清晰，无作弊逻辑

## 执行环境
- 工作目录：/home/zxh/ainovel_v3
- Python：/home/zxh/ainovel_v3/project/backend/.venv/bin/python
- Memgraph：localhost:7687
